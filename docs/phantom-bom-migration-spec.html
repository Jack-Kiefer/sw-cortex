<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Odoo Kits to Laravel Kits Migration</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 0 20px;
        line-height: 1.6;
        color: #333;
      }
      h1 {
        border-bottom: 3px solid #e94560;
        padding-bottom: 10px;
      }
      h2 {
        color: #e94560;
        margin-top: 40px;
      }
      h3 {
        color: #555;
        margin-top: 25px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background: #f5f5f5;
      }
      .owner {
        color: #27ae60;
        font-weight: 600;
      }
      .copy {
        color: #888;
      }
      .skip {
        color: #e74c3c;
        font-weight: 600;
      }
      code {
        background: #f5f5f5;
        padding: 2px 6px;
        border-radius: 3px;
      }
      .flow {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        font-family: monospace;
        white-space: pre;
        margin: 20px 0;
      }
      .highlight {
        background: #fff3cd;
        padding: 15px;
        border-left: 4px solid #e94560;
        margin: 20px 0;
      }
      .warning {
        background: #fef2f2;
        padding: 15px;
        border-left: 4px solid #e74c3c;
        margin: 20px 0;
      }
      .success {
        background: #f0fdf4;
        padding: 15px;
        border-left: 4px solid #27ae60;
        margin: 20px 0;
      }
      ul li {
        margin: 8px 0;
      }
    </style>
  </head>
  <body>
    <h1>Odoo Kits to Laravel Kits</h1>
    <p><strong>Move inventory decrements from Odoo to Laravel</strong></p>

    <h2>Goal</h2>
    <p>
      Add Odoo kit components (shippers, production paper, cups) to existing Laravel kits so all
      inventory decrements happen through Laravel instead of Odoo.
    </p>

    <h2>Goals</h2>
    <ul>
      <li>Migrate all phantom BOMs from Odoo to Laravel kits table</li>
      <li>Validate kit-to-buyer_product links</li>
      <li>Test order expansion with Laravel kits</li>
      <li>Deprecate Odoo phantom BOM lookups</li>
    </ul>

    <div class="highlight">
      <strong>Key:</strong> Runs parallel with Phase 2 (Bills/Products/MO). Kit migration is
      independent and can proceed without waiting for other work.
    </div>

    <h2>Current State</h2>
    <table>
      <tr>
        <th style="background: #fef2f2; color: #e94560">Laravel Kits</th>
        <th style="background: #f3e8ff; color: #714b67">Odoo Kits</th>
      </tr>
      <tr>
        <td>Boxes, inserts, mugs, accessories</td>
        <td>Shippers, production paper, cups</td>
      </tr>
      <tr>
        <td>Creates <code>component_orders</code></td>
        <td>Decrements inventory directly</td>
      </tr>
      <tr>
        <td>~900 existing kits</td>
        <td>267 Odoo kits</td>
      </tr>
    </table>
    <div class="warning">
      <strong>Gap:</strong> <code>component_orders</code> has no <code>odoo_sync</code> field, so
      nothing syncs back to Odoo.
    </div>

    <h2>What's in Odoo Kits</h2>
    <table>
      <tr>
        <th>Component Type</th>
        <th>Prefix</th>
        <th>Count</th>
        <th>Migrate?</th>
      </tr>
      <tr>
        <td>Shippers</td>
        <td><code>S-*</code></td>
        <td>40 SKUs</td>
        <td class="owner">Yes</td>
      </tr>
      <tr>
        <td>Inserts / Cups</td>
        <td><code>I-*</code></td>
        <td>20 SKUs</td>
        <td class="owner">Yes</td>
      </tr>
      <tr>
        <td>Production Paper</td>
        <td><code>P-*</code></td>
        <td>2 SKUs</td>
        <td class="owner">Yes</td>
      </tr>
      <tr>
        <td>Boxes</td>
        <td><code>B-*</code></td>
        <td>8 SKUs</td>
        <td class="owner">Yes</td>
      </tr>
      <tr>
        <td>Extras (care cards, coasters)</td>
        <td><code>E-*</code>, <code>SA-*</code></td>
        <td>11 SKUs</td>
        <td class="owner">Yes</td>
      </tr>
      <tr>
        <td>Labels</td>
        <td><code>L-*</code></td>
        <td>1 SKU</td>
        <td class="skip">No (qty=0)</td>
      </tr>
      <tr>
        <td>Tape</td>
        <td><code>T-*</code></td>
        <td>1 SKU</td>
        <td class="skip">No (qty=0)</td>
      </tr>
      <tr>
        <td>Test items</td>
        <td><code>QA-TEST-*</code></td>
        <td>3 SKUs</td>
        <td class="skip">No (test data)</td>
      </tr>
    </table>
    <p><strong>Total to migrate:</strong> ~80 unique components</p>

    <h2>How It Will Work</h2>
    <table style="margin: 20px 0">
      <tr>
        <th style="background: #fef2f2; color: #e94560">Laravel</th>
        <th style="width: 60px"></th>
        <th style="background: #f3e8ff; color: #714b67">Odoo</th>
      </tr>
      <tr>
        <td>Order placed</td>
        <td></td>
        <td style="color: #999">-</td>
      </tr>
      <tr>
        <td>Kit expanded to <code>component_orders</code></td>
        <td></td>
        <td style="color: #999">-</td>
      </tr>
      <tr>
        <td>(includes shipper, paper, cups now)</td>
        <td></td>
        <td style="color: #999">-</td>
      </tr>
      <tr style="background: #fff3cd">
        <td><strong>Sync job runs</strong></td>
        <td style="text-align: center">-></td>
        <td><strong>Inventory decremented</strong></td>
      </tr>
      <tr>
        <td>Mark <code>odoo_sync = 1</code></td>
        <td></td>
        <td style="color: #999">-</td>
      </tr>
    </table>
    <p><strong>Key:</strong> Yellow row = data pushed from Laravel to Odoo</p>

    <h2>Multiple Kits Per Product</h2>
    <p>
      Most buyer_products have 4-7 kit variants (sizes, seasonal). Odoo kit components should be
      added to <strong>all</strong> kits for that product.
    </p>

    <h2>Database Changes</h2>
    <table>
      <tr>
        <th>Table</th>
        <th>Change</th>
      </tr>
      <tr>
        <td><code>component_orders</code></td>
        <td>
          Add <code>odoo_sync TINYINT(1) DEFAULT 0</code><br />
          Add <code>odoo_synced_at TIMESTAMP NULL</code>
        </td>
      </tr>
      <tr>
        <td><code>components</code></td>
        <td>Import ~80 new components from Odoo</td>
      </tr>
      <tr>
        <td><code>component_kits</code></td>
        <td>Add ~4,000 new rows (267 Odoo kits x 5 Laravel kits x 3 components)</td>
      </tr>
    </table>

    <h2>Scale</h2>
    <ul>
      <li>267 Odoo kits to migrate</li>
      <li>~80 components to import</li>
      <li>~900 existing kits to expand</li>
      <li>~4,000 new <code>component_kits</code> rows</li>
      <li>Adds ~3 components per kit (shipper, paper, cup/insert)</li>
    </ul>

    <h2>Decisions Made</h2>
    <table>
      <tr>
        <th>Question</th>
        <th>Decision</th>
      </tr>
      <tr>
        <td>Kit variants</td>
        <td class="owner">Add to ALL kits for each product</td>
      </tr>
      <tr>
        <td>Historical orders</td>
        <td class="owner">New orders only (no backfill)</td>
      </tr>
      <tr>
        <td>Missing kits</td>
        <td class="owner">Auto-create default kit</td>
      </tr>
      <tr>
        <td>Receiving</td>
        <td class="owner">Keep in Odoo</td>
      </tr>
    </table>

    <h2>Data Ownership</h2>
    <table>
      <tr>
        <th>Data</th>
        <th style="background: #fef2f2; color: #e94560">Laravel</th>
        <th style="background: #f3e8ff; color: #714b67">Odoo</th>
      </tr>
      <tr>
        <td>Kit definitions (265 phantom BOMs)</td>
        <td class="owner">Owner</td>
        <td class="skip">Deprecated</td>
      </tr>
      <tr>
        <td>Kit components (<code>component_kits</code> junction)</td>
        <td class="owner">Owner</td>
        <td class="skip">Deprecated</td>
      </tr>
      <tr>
        <td>Kit-to-buyer_product links</td>
        <td class="owner">Owner</td>
        <td class="copy">—</td>
      </tr>
    </table>

    <h2>How It Works (Workflow)</h2>
    <table>
      <tr>
        <th style="background: #fef2f2; color: #e94560">Laravel (SERP)</th>
        <th style="width: 60px"></th>
        <th style="background: #f3e8ff; color: #714b67">Odoo</th>
      </tr>
      <tr>
        <td>Migrate 265 phantom BOMs → <code>kits</code> table</td>
        <td></td>
        <td class="copy">Read-only source</td>
      </tr>
      <tr>
        <td>Kit defines components (shippers, inserts, boxes)</td>
        <td></td>
        <td class="copy">—</td>
      </tr>
      <tr>
        <td>Order placed → <code>ComponentOrder</code> created for all kit components</td>
        <td></td>
        <td class="copy">—</td>
      </tr>
      <tr>
        <td>Order expansion uses Laravel kits</td>
        <td></td>
        <td class="skip">Deprecated</td>
      </tr>
    </table>

    <h2>Existing Odoo Features</h2>
    <ul>
      <li><code>mrp_bom</code> with <code>type=phantom</code> (265 active kits)</li>
      <li><code>mrp_bom_line</code> for kit components (~800 records)</li>
      <li>Kit expansion called on order creation</li>
    </ul>

    <h2>New Features (After Migration)</h2>
    <ul>
      <li>All order expansion uses Laravel kits</li>
      <li>Kit management UI in SERP</li>
      <li>Kit version history and audit logging</li>
    </ul>

    <h2>Implementation Details</h2>
    <ul>
      <li>
        Phantom BOM migration: <code>INSERT SELECT</code> from Odoo <code>mrp_bom</code> where
        <code>type=phantom</code>
      </li>
      <li>265 BOMs with avg 2-3 components each (simple structure, no nesting)</li>
      <li>Zero-qty consumables (tape, labels) migrated with <code>qty=0</code></li>
      <li>Kit diff report comparing Laravel vs Odoo for validation</li>
      <li>Parallel run period to validate order expansion</li>
    </ul>

    <h2>Timeline (10 Weeks)</h2>
    <table>
      <tr>
        <th>Week</th>
        <th>Tasks</th>
      </tr>
      <tr>
        <td><strong>Week 1-2</strong></td>
        <td>
          <ul style="margin: 0; padding-left: 20px">
            <li>Analyze Odoo phantom BOMs structure</li>
            <li>Map phantom BOM components to Laravel components</li>
            <li>Document kit-to-buyer_product relationships</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Week 3-4</strong></td>
        <td>
          <ul style="margin: 0; padding-left: 20px">
            <li>Write phantom BOM export script</li>
            <li>Build migration script (Odoo → Laravel kits)</li>
            <li>Handle zero-qty consumables (tape, labels)</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Week 5-6</strong></td>
        <td>
          <ul style="margin: 0; padding-left: 20px">
            <li>Build kit validation report</li>
            <li>Test kit expansion in order flow</li>
            <li>Validate kit-to-buyer_product links</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Week 7-8</strong></td>
        <td>
          <ul style="margin: 0; padding-left: 20px">
            <li>Test ComponentOrder creation for all kit components</li>
            <li>Build kit diff report (Laravel vs Odoo)</li>
            <li>Deploy kit migration to staging</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Week 9-10</strong></td>
        <td>
          <ul style="margin: 0; padding-left: 20px">
            <li>Deploy kit migration to production</li>
            <li>Parallel run: validate orders use Laravel kits</li>
            <li>Cutover: disable Odoo phantom BOM lookups</li>
          </ul>
        </td>
      </tr>
    </table>

    <div class="highlight">
      <strong>Sync cutoff:</strong> Only <code>component_orders</code> created after migration will
      sync. Add <code>WHERE created_at > '2026-01-28'</code> to sync query.
    </div>
  </body>
</html>
