<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SERP Migration Plan - Part 2: Completion â€” 14 Weeks (Manufacturing, Inventory, Final Cutover)</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f8f9fa;
        color: #333;
        line-height: 1.6;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 30px;
      }
      h1 {
        color: #212529;
        font-size: 1.8em;
      }
      .meta {
        color: #6c757d;
        font-size: 0.9em;
      }
      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }
      .summary-card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .summary-card .value {
        font-size: 2em;
        font-weight: 700;
        color: #198754;
      }
      .summary-card .label {
        color: #6c757d;
        font-size: 0.85em;
        margin-top: 5px;
      }
      .timeline-container {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .timeline-header {
        display: flex;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .timeline-label {
        width: 220px;
        font-weight: 600;
        color: #495057;
        font-size: 0.9em;
      }
      .timeline-months {
        display: flex;
        flex: 1;
      }
      .month-col {
        flex: 1;
        text-align: center;
        font-size: 0.8em;
        font-weight: 600;
        color: #495057;
        padding: 8px 4px;
        border-left: 1px solid #e9ecef;
        background: #f8f9fa;
      }
      .month-col:first-child {
        border-left: none;
      }
      .phase-row {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }
      .phase-label {
        width: 220px;
        font-weight: 500;
        font-size: 0.9em;
        color: #495057;
      }
      .phase-track {
        flex: 1;
        height: 44px;
        position: relative;
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border-radius: 6px;
      }
      .phase-bar {
        position: absolute;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 12px;
        font-size: 0.8em;
        font-weight: 500;
        color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }
      .phase-dates {
        font-size: 0.75em;
        opacity: 0.9;
      }
      .phase-detail {
        background: #fff;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
        overflow: hidden;
      }
      .phase-header {
        padding: 24px;
        border-left: 5px solid;
        cursor: pointer;
        transition: background 0.2s;
      }
      .phase-header:hover {
        background: #f8f9fa;
      }
      .phase-header h2 {
        font-size: 1.3em;
        margin-bottom: 8px;
        color: #212529;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .phase-header h2 .toggle {
        font-size: 0.8em;
        color: #6c757d;
        transition: transform 0.2s;
        transform: rotate(90deg);
      }
      .phase-header.collapsed h2 .toggle {
        transform: rotate(0deg);
      }
      .phase-meta-info {
        color: #6c757d;
        font-size: 0.9em;
        margin-bottom: 12px;
      }
      .phase-goal-text {
        background: #f8f9fa;
        padding: 14px;
        border-radius: 8px;
        color: #495057;
        font-size: 0.95em;
      }
      .phase-content {
        display: block;
        padding: 0 24px 24px;
        border-top: 1px solid #e9ecef;
      }
      .phase-content.hide {
        display: none;
      }
      .section {
        margin-top: 24px;
      }
      .section h3 {
        font-size: 1.05em;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 2px solid;
        color: #495057;
      }
      .section h4 {
        font-size: 0.95em;
        margin: 16px 0 8px;
        color: #495057;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 12px 0;
        font-size: 0.9em;
      }
      th,
      td {
        padding: 10px 12px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
      }
      th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
      }
      .owner-cell {
        color: #198754;
        font-weight: 600;
      }
      .copy-cell {
        color: #6c757d;
      }
      .workflow-table th:first-child {
        background: #e8f5e9;
        color: #198754;
      }
      .workflow-table th:last-child {
        background: #f3e5f5;
        color: #7b1fa2;
      }
      .workflow-table .sync-row {
        background: #fff3cd;
      }
      .workflow-table .arrow {
        text-align: center;
        color: #6c757d;
      }
      ul {
        margin: 8px 0;
        padding-left: 24px;
      }
      li {
        margin: 6px 0;
      }
      .highlight {
        background: #fff3cd;
        padding: 12px 16px;
        border-left: 4px solid;
        margin: 16px 0;
        font-weight: 500;
      }
      code {
        background: #f1f3f5;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.85em;
      }
      .gantt-container {
        overflow-x: auto;
        margin-top: 16px;
      }
      .gantt-header {
        display: flex;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 8px;
        min-width: 800px;
      }
      .gantt-label {
        width: 280px;
        min-width: 280px;
        padding: 10px;
        font-weight: 600;
        color: #495057;
        font-size: 0.85em;
      }
      .gantt-weeks {
        display: flex;
        flex: 1;
      }
      .week-col {
        flex: 1;
        text-align: center;
        padding: 8px 4px;
        font-size: 0.75em;
        font-weight: 600;
        color: #495057;
        border-left: 1px solid #e9ecef;
        background: #f8f9fa;
      }
      .week-col:first-child {
        border-left: none;
      }
      .week-dates {
        font-size: 0.7em;
        color: #6c757d;
        font-weight: 400;
      }
      .gantt-row {
        display: flex;
        align-items: center;
        min-height: 36px;
        border-bottom: 1px solid #f1f3f5;
        min-width: 800px;
      }
      .gantt-row:hover {
        background: #f8f9fa;
      }
      .task-label {
        width: 280px;
        min-width: 280px;
        padding: 6px 10px;
        font-size: 0.85em;
        color: #495057;
      }
      .task-track {
        display: flex;
        flex: 1;
        position: relative;
        height: 26px;
      }
      .task-cell {
        flex: 1;
        border-left: 1px solid #f1f3f5;
      }
      .task-cell:first-child {
        border-left: none;
      }
      .task-bar {
        position: absolute;
        height: 20px;
        top: 3px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7em;
        font-weight: 500;
        color: white;
      }
      .milestones {
        background: #fff;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .milestones h3 {
        margin-bottom: 20px;
        color: #495057;
        font-size: 1.1em;
      }
      .milestone-item {
        display: flex;
        align-items: center;
        padding: 14px 0;
        border-bottom: 1px solid #e9ecef;
      }
      .milestone-item:last-child {
        border-bottom: none;
      }
      .milestone-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 15px;
      }
      .milestone-info {
        flex: 1;
      }
      .milestone-name {
        font-weight: 500;
        color: #212529;
      }
      .milestone-phase {
        font-size: 0.85em;
        color: #6c757d;
      }
      .milestone-date {
        font-weight: 600;
        color: #198754;
      }
      .migration-events {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .migration-events h3 {
        margin-bottom: 5px;
        color: #495057;
      }
      .migration-event {
        display: flex;
        align-items: flex-start;
        padding: 12px 0;
        border-bottom: 1px solid #f1f3f5;
      }
      .migration-event:last-child {
        border-bottom: none;
      }
      .migration-event-phase {
        width: 100px;
        min-width: 100px;
        font-weight: 600;
        font-size: 0.85em;
      }
      .migration-event-week {
        width: 80px;
        min-width: 80px;
        color: #6c757d;
        font-size: 0.85em;
      }
      .migration-event-info {
        flex: 1;
      }
      .migration-event-name {
        font-weight: 600;
        margin-bottom: 4px;
      }
      .migration-event-desc {
        color: #6c757d;
        font-size: 0.85em;
      }
      .migration-event-tables {
        margin-top: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .migration-event-tables code {
        background: #e9ecef;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
      }
      @media print {
        .phase-content {
          display: block !important;
        }
        .phase-header {
          break-after: avoid;
        }
        .phase-detail {
          break-inside: avoid;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div>
          <h1>SERP Migration Plan - Part 2: Completion â€” 14 Weeks (Manufacturing, Inventory, Final Cutover)</h1>
          <div class="meta" id="meta"></div>
        </div>
      </header>
      <div class="summary-cards" id="summary"></div>
      <div style="display:flex;gap:16px;align-items:center;margin-bottom:20px;padding:10px 16px;background:#fff;border-radius:8px;border:1px solid #e9ecef;font-size:0.85em">
        <strong style="color:#495057">Owner Legend:</strong>
        <span style="display:inline-flex;align-items:center;gap:4px"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#3498db"></span> Jack</span>
        <span style="display:inline-flex;align-items:center;gap:4px"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#e67e22"></span> Laravel Dev(s)</span>
        <span style="display:inline-flex;align-items:center;gap:4px"><span style="display:inline-block;width:14px;height:14px;border-radius:3px;background:#8e44ad"></span> Both</span>
      </div>
      <div class="timeline-container">
        <div class="timeline-header">
          <div class="timeline-label">Phase</div>
          <div class="timeline-months" id="months"></div>
        </div>
        <div id="timeline"></div>
        <div style="margin-top: 12px; font-size: 0.8em; color: #6c757d">
          <strong>âˆ¥</strong> = Phases run in parallel
        </div>
      </div>
      <div class="migration-events">
        <h3>ðŸ“¦ Data Migration Timeline</h3>
        <p style="color: #6c757d; font-size: 0.9em; margin-bottom: 15px">
          When Odoo data gets imported into SERP tables
        </p>
        <div id="migration-events"></div>
      </div>
      <div class="milestones">
        <h3>Key Milestones</h3>
        <div id="milestones"></div>
      </div>
      <h2 style="margin: 30px 0 20px; color: #495057; font-size: 1.3em">Phase Details</h2>
      <div id="phases-detail"></div>
          <!-- Future Improvements -->
      <div class="phase-detail" style="margin-top: 40px">
        <div
          class="phase-header"
          style="border-left-color: #6c757d"
          onclick="togglePhase('future')"
        >
          <h2><span class="toggle">â–¶</span> Future Improvements</h2>
          <div class="phase-meta-info">Features not currently in Odoo â€” to be built as needed</div>
          <div class="phase-goal-text">
            These are <strong>new capabilities</strong> that don't exist in Odoo today. They can be
            built in SERP independently of the core migration phases, prioritized by business need.
          </div>
        </div>
        <div class="phase-content" id="phase-content-future">
          <div class="section">
            <h3 style="border-color: #6c757d">Why These Are Separate</h3>
            <div class="highlight" style="border-color: #0d6efd; background: #e3f2fd">
              <strong>These features don't exist in Odoo.</strong> The main migration phases focus
              on replacing existing Odoo functionality. These improvements are net-new capabilities
              that can be built on-demand.
            </div>
          </div>
          <div class="section">
            <h3 style="border-color: #6c757d">Available Improvements</h3>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #198754;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">Blanket PO Tracking</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Track long-term vendor agreements with multiple releases. SERP manages the
                agreement, Odoo receives individual release POs.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Create Agreement:</strong> Blanket PO in SERP with total qty, price terms,
                  validity period
                </li>
                <li>
                  <strong>Release Orders:</strong> Each release creates a real purchase.order in
                  Odoo
                </li>
                <li>
                  <strong>Track Usage:</strong> SERP tracks total released vs. agreement amount
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> No native blanket/framework PO support exists.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #fd7e14;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">PO Approval Workflows</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Route POs for approval based on amount thresholds. Notify via Slack, update Odoo
                when approved.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Threshold Rules:</strong> POs over $X need manager, over $Y need director
                </li>
                <li>
                  <strong>Multi-Step:</strong> Ops approval first, then Finance for larger amounts
                </li>
                <li>
                  <strong>Slack Integration:</strong> Approver receives Slack message with
                  approve/reject buttons
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> studio_approval_rule exists but has 0 active rules
                configured.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #dc3545;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">
                Supplier Forecast â†’ Odoo Integration
              </h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Turn SERP supplier forecasts into draft POs in Odoo with one click.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Generate:</strong> Supplier Forecast calculates what to order based on
                  demand
                </li>
                <li><strong>Review:</strong> User reviews and adjusts suggested quantities</li>
                <li>
                  <strong>Push:</strong> Click "Send to Odoo" to create draft purchase.order records
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> Odoo has no forecasting integration. Tool exists
                in SERP already.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #6f42c1;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">Inventory Adjustment Approvals</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Require approval for manual inventory adjustments above a threshold.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li><strong>Request:</strong> User submits adjustment with reason code</li>
                <li><strong>Threshold Check:</strong> Large adjustments require approval</li>
                <li><strong>Audit Trail:</strong> Log who requested, who approved, and why</li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> Odoo allows direct adjustments with no approval
                gate.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #0dcaf0;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">Shopify Order Integration</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Pull Shopify orders directly into SERP for automated inventory adjustments, replacing
                the current manual process of monthly WCC reports.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Auto-Import:</strong> Shopify orders flow into SERP automatically via API
                </li>
                <li>
                  <strong>Inventory Deductions:</strong> SERP adjusts inventory in real-time instead of
                  monthly manual adjustments
                </li>
                <li>
                  <strong>COGS Tracking:</strong> FIFO cost applied to Shopify orders same as all other
                  order types
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why post-launch:</strong> Odoo currently receives manual monthly adjustments
                from WCC reports â€” not a direct Shopify integration. Manual adjustments will still work
                in SERP. Full Shopify integration is a net-new capability.
              </div>
            </div>
          </div>
    </div>
    <script>
      // Part 2 starts when Part 1 Phase 3 ends (Feb 16 + 9w Phase 1 + 8w Phase 3 = Jun 15)
      // Phase 5 (Kits, 8w) runs parallel with Phase 4, both start Jun 15
      // Part 2 starts when Part 1 Phase 3 ends (Feb 16 + 9w Phase 1 + 7w Phase 3 = Jun 8)
      const PROJECT_START = '2026-06-08';
      const project = { startDate: PROJECT_START, preparedBy: 'Jack Kiefer' };

      const phases = [
{
          id: 4,
          name: 'Manufacturing, Adjustments, BOMs, Locations & Products',
          shortName: 'MO+Adj+BOMs+Loc+Prod',
          weeks: 8,
          deps: [3],
          parallelWith: [5],
          color: '#9b59b6',
          milestone: 'MO, Adjustments, BOMs, Locations & Products Live',
          goal: 'Product UI first, then import ALL Odoo products into SERP. Then build remaining Odoo features. Users switch to SERP UI, which dual-writes to both Odoo (XML-RPC) and SERP tables (stock_quants). Incremental by feature. Laravel Dev handles product import + MO/BOM/location migration scripts in parallel.',
          goals: [
            'FIRST: Build product management UI in SERP so all products can be managed there',
            'Import ALL Odoo products (~3,900 missing) into SERP via product UI â€” raw materials, packed products, labels, cartons, etc. Currently only ~598 exist (packaging only). Every Odoo product_id in BOMs/MOs/stock_quant must have a SERP equivalent before migration.',
            'Backfill components.odoo_id mapping â€” current values are external references ("800" + component.id), need real Odoo product_product.id for migration FK resolution',
            'Build remaining features in SERP that replicate Odoo functionality',
            'Users switch to SERP UI for each feature (stop using Odoo UI)',
            'Dual-write: SERP sends XML-RPC to Odoo AND updates SERP shadow tables',
            'stock_quants table is independent (no linkage to component/RM inventory yet)',
            'Incremental rollout: Product UI â†’ Product Import â†’ Manufacturing â†’ Adjustments â†’ BOMs (normal only, kits in Phase 5) â†’ Stock Locations',
            'Track COGS correctly throughout transition',
          ],
          tasks: [
            { name: 'Build product management UI with cost tracking', owner: 'Jack', startWeek: 1, duration: 2 },
            {
              name: 'Import ~3,900 missing Odoo products into SERP (Laravel Dev runs pre-built scripts)',
              owner: 'Laravel Dev',
              startWeek: 3,
              duration: 1,
            },
            { name: 'Backfill real Odoo product_product.id mapping (SKU match + update odoo_id)', owner: 'Laravel Dev', startWeek: 3, duration: 1 },
            { name: 'Cutover products: SERP becomes SOT for product management', owner: 'Both', startWeek: 3, duration: 1 },
            {
              name: 'Build MO UI, creation/tracking/completion/scrapping',
              owner: 'Jack',
              startWeek: 3,
              duration: 2,
            },
            { name: 'Build inventory adjustments + stock moves with COGS tracking', owner: 'Jack', startWeek: 3, duration: 2 },
            { name: 'Build BOM management UI (normal BOMs only â€” kit/phantom BOMs in Phase 5)', owner: 'Jack', startWeek: 5, duration: 2 },
            { name: 'Build stock_locations and location UI', owner: 'Jack', startWeek: 5, duration: 2 },
            { name: 'Migrate MOs, BOMs, locations from Odoo (Laravel Dev runs migration scripts)', owner: 'Laravel Dev', startWeek: 6, duration: 1 },
            { name: 'Cutover MO + adjustments + BOMs + locations: users switch to SERP', owner: 'Both', startWeek: 7, duration: 1 },
            {
              name: 'End-to-end testing, COGS validation, stabilization',
              owner: 'Both',
              startWeek: 8,
              duration: 1,
            },
          ],
          workflow: [
            {
              laravel: 'User performs action in SERP UI (stops using Odoo UI)',
              odoo: 'Odoo UI still accessible but users directed to SERP',
            },
            {
              laravel: 'SERP dual-writes: XML-RPC to Odoo + update stock_quants',
              odoo: 'Receives sync, stays in sync',
              sync: true,
            },
            {
              laravel: 'stock_quants updated independently (not linked to component inventory)',
              odoo: 'â€”',
            },
            { laravel: 'MO created/completed/scrapped in SERP', odoo: 'XML-RPC sync', sync: true },
            {
              laravel: 'Inventory adjustment in SERP + COGS tracking',
              odoo: 'XML-RPC sync',
              sync: true,
            },
            { laravel: 'Normal (non-kit) BOM create/edit in SERP (kit BOMs in Phase 5)', odoo: 'XML-RPC sync', sync: true },
            { laravel: 'Location management in SERP', odoo: 'XML-RPC sync', sync: true },
            { laravel: 'Product management in SERP', odoo: 'XML-RPC sync', sync: true },
          ],
          dataOwnership: [
            { data: 'Manufacturing orders', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Inventory adjustments', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'BOMs (normal only â€” kit/phantom BOMs in Phase 5)', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Stock locations', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Products (5,809)', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            {
              data: 'stock_quants (shadow)',
              laravel: 'Owner (independent)',
              odoo: 'Has its own copy',
            },
            { data: 'component_inventory', laravel: 'Unchanged', odoo: 'â€”' },
            { data: 'Valuation layers (COGS)', laravel: 'Owner', odoo: 'â€”' },
          ],
          implementation: [
            '--- PRODUCT UI + IMPORT (Weeks 1-3, Laravel Dev handles import scripts) ---',
            'â€¢ Build product management UI first so all products are managed in SERP',
            'â€¢ Laravel components table currently has ~598 records (mostly packaging: boxes, inserts, shippers)',
            'â€¢ Odoo has ~4,300 active storable products with SKUs referenced in BOMs/MOs/stock_quant',
            'â€¢ Missing ~3,900 products: raw materials (candy, cookies, etc.), packed products, labels, cartons, gift sets, etc.',
            'â€¢ Import all Odoo products into SERP via the new product UI / bulk import tool',
            'â€¢ Set odoo_id = "800" + component.id per existing convention (Component.php setOddoId())',
            'â€¢ Also need real Odoo product_product.id mapping: match by SKU (components.sku = product_product.default_code) for migration FK resolution',
            'â€¢ 5 existing components already have real Odoo IDs (hot sauce foam inserts, ids 646-650)',
            'â€¢ ~160 Odoo products without SKUs are junk (copies, freight charges) â€” skip these',
            '--- END PRODUCT UI + IMPORT ---',
            'Incremental rollout: Product UI â†’ Product Import â†’ MO â†’ Adjustments â†’ BOMs (normal only) â†’ Locations',
            'Pattern: build feature in SERP â†’ users switch to SERP UI â†’ disable Odoo UI',
            'Dual-write on every action: XML-RPC to Odoo + update SERP tables',
            '--- USES SYNC QUEUE FROM PHASE 3 ---',
            'â€¢ Same odoo_sync_queue table and infrastructure built in Phase 3',
            'â€¢ Extend with new entity_types: mrp_production, stock_move, mrp_bom, stock_location, product',
            'â€¢ Same retry logic, DLQ, circuit breaker patterns',
            '--- END SYNC QUEUE ---',
            'stock_quants is independent shadow table (NOT linked to component/RM inventory)',
            'Existing component_inventory unchanged during this phase',
            'Manufacturing: MO in SERP, dual-writes to Odoo mrp_production',
            'MO scrapping/cancellation: cancel defective MOs, reverse any partial consumption',
            'Adjustments: adjustment in SERP updates stock_quants + XML-RPC to Odoo stock_move',
            'BOMs: normal (non-kit) BOM management in SERP, syncs to Odoo mrp_bom. Kit/phantom BOMs handled in Phase 5',
            'Stock locations: location hierarchy in SERP, syncs to Odoo stock_location',
            'Products: product info in SERP, syncs to Odoo product_product',
            'COGS tracking: valuation layers updated on MO completion and adjustments',
            'Odoo stays in sync but users stop using Odoo UI for migrated features',
            'Python function suite: reusable functions for inventory ops that maintain DB integrity',
            'Functions: make_adjustment(), receive_arrival(), complete_mo(), scrap_mo()',
            'All functions enforce COGS structure, update valuation layers, log transactions',
          ],
          confirmations: [
            'Production team - MO creation and completion workflow',
            'Warehouse team - inventory adjustments and location management',
            'Finance team - COGS calculations and valuation accuracy',
            'Operations team - BOM management and product info',
          ],
          keyPoint:
            'Product UI built FIRST (Weeks 1-2), then Laravel Dev imports ~3,900 missing Odoo products via pre-built scripts (Week 3) while Jack starts MO/adjustment UI in parallel. Remaining features: BOMs, locations. Dual-writes to Odoo throughout. stock_quants is independent (not linked to component inventory yet).',
        },
{
          id: 6,
          name: 'Inventory Management',
          shortName: 'Inventory',
          weeks: 6,
          deps: [4],
          color: '#dc3545',
          milestone: 'Full Inventory Cutover',
          goal: 'Make SERP the source of truth for inventory. Migrate all inventory + FIFO layers from Odoo. Build financial reports for Ric. Update ALL code across ALL systems (SERP, Laravel, n8n, Retool, WishDesk, Lambda) to use inventory views. Deprecate Odoo.',
          goals: [
            'Migrate all inventory from Odoo to SERP stock_quant (quantities + FIFO cost layers)',
            'Make stock_quant the single source of truth for inventory',
            'Update ALL code across ALL systems to JOIN inventory views instead of reading inventory_qty columns â€” SERP, Laravel, n8n workflows, Retool apps/workflows, WishDesk, and Lambda functions (views created in Phase 1)',
            'Build financial reports for Ric (Valuation, Roll Forward, FIFO COGS, Cost Tracking)',
            'Complete cutover: activate SERP queues, disable Odoo sync',
          ],
          tasks: [
            {
              name: 'Build financial reports (Valuation, Roll Forward, FIFO COGS)',
              owner: 'Jack',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Prepare inventory view migration for ALL systems (SERP, Laravel, n8n, Retool, WishDesk, Lambda)',
              owner: 'Both',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'âš¡ PARALLEL RUN: compare SERP vs Odoo inventory daily',
              owner: 'Jack',
              startWeek: 2,
              duration: 3,
            },
            {
              name: 'Build + test ALL migration scripts: stock_quant, valuation layers, scrap, landed costs, COGS backfill â€” dry-run against staging',
              owner: 'Laravel Dev',
              startWeek: 2,
              duration: 2,
            },
            {
              name: 'Freeze Odoo, migrate inventory + FIFO layers + historical COGS backfill to SERP',
              owner: 'Laravel Dev',
              startWeek: 5,
              duration: 1,
            },
            {
              name: 'Physical count, reconcile, validate with Ric + go-live',
              owner: 'Both',
              startWeek: 6,
              duration: 1,
            },
          ],
          workflow: [
            { laravel: 'stock_quant is source of truth for inventory quantities', odoo: 'â€”' },
            { laravel: 'Inventory views created in Phase 1 â€” ALL systems updated to use them (SERP, Laravel, n8n, Retool, WishDesk, Lambda)', odoo: 'â€”' },
            { laravel: 'Order queue built in Phase 2, expanded in Phase 7 â€” processes all orders', odoo: 'â€”' },
            { laravel: 'Parallel run: SERP and Odoo both track inventory, compare daily', odoo: 'Still active' },
            { laravel: 'Cutover: freeze Odoo, migrate inventory + FIFO layers to SERP', odoo: 'Frozen' },
            { laravel: 'Physical count reconciliation, validate with Ric, go-live', odoo: 'Deprecated' },
          ],
          dataOwnership: [
            { data: 'stock_quant (source of truth)', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'FIFO valuation layers', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'COGS (cost_unit on items/component_orders)', laravel: 'Owner', odoo: 'â€”' },
            { data: 'Financial reports (Valuation, Roll Forward, COGS)', laravel: 'Owner', odoo: 'â€”' },
          ],
          implementation: {
            'Code Migration â€” ALL Systems (inventory views created in Phase 1)': [
              '--- SERP (Jack) ---',
              'Find all code reading receiver_products.inventory_qty â†’ change to JOIN receiver_product_inventory',
              'Find all code reading components.inventory_qty â†’ change to JOIN component_inventory',
              'Update all SERP API endpoints, reports, dashboards that reference inventory columns',
              'Test all inventory-related features with new views',
              '--- LARAVEL (Laravel Dev Task) ---',
              'Audit all Laravel code reading inventory_qty from receiver_products and components tables',
              'Update Eloquent queries/scopes to JOIN inventory views instead of reading inventory_qty columns',
              'Update any blade templates, API responses, or exports that display inventory quantities',
              'Coordinate timing: Laravel changes deploy same day as SERP inventory cutover',
              '--- N8N WORKFLOWS ---',
              'Audit all n8n workflows that query inventory_qty (MySQL/Postgres nodes)',
              'Update SQL in workflow nodes to JOIN inventory views instead of reading inventory_qty',
              'Test updated workflows in staging before cutover',
              '--- RETOOL APPS + RETOOL WORKFLOWS ---',
              'Audit all Retool apps (dashboards, admin tools) that display inventory_qty',
              'Update Retool SQL queries to JOIN inventory views',
              'Audit Retool Workflows (automated jobs) that read inventory_qty',
              'Update Retool Workflow SQL to JOIN inventory views',
              '--- WISHDESK ---',
              'Audit WishDesk code that reads inventory_qty (ticket display, order context)',
              'Update queries to JOIN inventory views',
              '--- LAMBDA FUNCTIONS ---',
              'Audit Lambda functions that query inventory_qty (order processing, reporting)',
              'Update SQL queries in Lambda code to JOIN inventory views',
              'Deploy updated Lambda functions before cutover',
              '--- COORDINATION ---',
              'All systems must be updated BEFORE dropping inventory_qty columns',
              'Deploy all changes simultaneously during cutover window',
              'Rollback plan: inventory_qty columns kept as backup for 2 weeks post-cutover',
            ],
            'Financial Reports': [
              'Inventory Valuation Report: current value of all stock by product/location',
              'Inventory Roll Forward: beginning + purchases + MO output - COGS - adjustments = ending',
              'FIFO COGS Report: cost breakdown per order/shipment using valuation layers',
              'Cost Tracking: unit cost trends over time by product',
            ],
            'Data Migration â€” Prep + Test (Weeks 2-3)': [
              '--- BUILD ALL MIGRATION SCRIPTS ---',
              'stock_quant script: export Odoo stock_quant (14K rows) â†’ SERP stock_quant, map product_id â†’ component_id via Phase 4 mapping',
              'valuation layer script: export active SVL (~3.7K rows, remaining_qty > 0) â†’ SERP stock_valuation_layer, preserve FIFO chain',
              'scrap/landed cost scripts: stock_scrap (1.4K), stock_landed_cost (87), stock_landed_cost_lines (88)',
              'COGS backfill script: sale_order.sw_id â†’ stock_move â†’ SVL â†’ write cost_unit + stock_move_id to items/component_orders (~2M orders)',
              'All scripts use product mapping from Phase 4 Week 3 â€” Laravel Dev\'s import (Odoo product_id â†’ SERP component_id)',
              '--- DRY-RUN AGAINST STAGING ---',
              'Run all scripts against Odoo staging â†’ Laravel staging (not production)',
              'Validate row counts: expected vs actual for every table',
              'Validate FK integrity: all component_id, location_id, move_id references resolve',
              'Validate FIFO math: sum of remaining_value across layers matches expected inventory valuation',
              'COGS backfill: spot-check ~100 orders across date ranges, compare cost_unit vs Odoo reports',
              'Performance test: measure time per batch, estimate total runtime for production',
              'Document rollback procedure for each script',
            ],
            'Data Migration â€” Execute (Week 5, Odoo Freeze)': [
              'Freeze Odoo â€” no new orders synced',
              'Run Laravel migrations: add cost_unit + stock_move_id columns to items and component_orders',
              'Execute stock_quant migration (14K rows)',
              'Execute valuation layer migration (~3.7K active layers)',
              'Execute scrap + landed cost migration',
              'Execute COGS backfill (~2M orders)',
              'Physical count reconciliation to verify migrated quantities',
            ],
            'Historical COGS Backfill Details': [
              '--- JOIN CHAIN ---',
              'sale_order.sw_id â†’ sale_order_line â†’ stock_move (sale_line_id) â†’ stock_valuation_layer (unit_cost)',
              '13.1M SVL consumption records (negative qty) map back to individual stock_moves with SKUs',
              'Match to Laravel: stock_move SKU â†’ items.product_sku (SA-* receiver products) or component_orders.component_sku (B-*/S-*/P-*/E-* packaging)',
              'Write cost_unit + stock_move_id back to items and component_orders rows',
              '--- EDGE CASES ---',
              'Null-SKU phantom parents: skip â€” child moves have real SKUs',
              'Orders with no Odoo sale_order (pre-Odoo era): cost_unit = NULL â€” acceptable',
              'Cancelled orders: include if they had fulfilled stock_moves (COGS was consumed)',
              'Batch by order_id range, ~50K orders/batch',
              '--- RESULT ---',
              'After backfill, ALL fulfilled orders have cost_unit â€” historical and future',
              'Full margin analysis across entire order history, not just post-cutover',
              'SERP COGS reports work for any date range without needing to query Odoo',
            ],
          },
          cutoverChecklist: [
            'All inventory data migrated from Odoo to SERP stock_quant',
            'All FIFO valuation layers migrated from Odoo to SERP',
            'All code updated to use inventory views across ALL systems: SERP, Laravel, n8n, Retool apps, Retool workflows, WishDesk, Lambda (no direct inventory_qty reads)',
            'Parallel run completed â€” SERP and Odoo inventory match',
            'Historical COGS backfilled: cost_unit + stock_move_id written to items/component_orders for all ~2M fulfilled orders',
            'COGS accuracy validated between Odoo and SERP',
            'Physical count reconciliation completed',
            'Financial reports reviewed and approved by Ric',
            'Legacy tables dropped (serp_audit_logs, component_shelves, etc.)',
            'Odoo order sync disabled',
            'Rollback plan documented and tested',
          ],
          confirmations: [
            'Ops - inventory counts match stock_quant',
            'Finance - COGS calculations and valuation accuracy',
            'Tech - all syncs work',
            'Jack - SERP order APIs (/reserve, /ship, /cancel) tested with all order types at full volume',
            'Jack - COGS write-back (cost_unit) validated for receiver products, kits, custom branding, and preselect orders',
            'Laravel dev - all Laravel inventory_qty reads replaced with inventory view JOINs',
            'All systems verified - n8n, Retool, WishDesk, Lambda updated and tested',
          ],
          keyPoint:
            'SERP becomes source of truth. Inventory migrated from Odoo, views already built in Phase 1, order queue already built in Phase 2/7. This phase migrates data, updates code across ALL systems (SERP, Laravel, n8n, Retool, WishDesk, Lambda), builds reports, and cuts over. Laravel dev handles Laravel-side changes in parallel.',
        },
{
          id: 7,
          name: 'Laravel Order Queue (All Orders)',
          shortName: 'Laravel All Orders',
          weeks: 4,
          deps: [4],
          parallelWith: [6],
          color: '#e74c3c',
          milestone: 'All Orders Process Through SERP',
          goal: 'Laravel developer expands the order queue built in Part 1 Phase 2 (custom branding only) to call SERP APIs for ALL ec_order types AND preselect_orders. Same 3 API calls: reserve, ship, cancel.',
          goals: [
            'Remove merchandise_selections filter â€” detect ALL ec_orders, not just custom branding',
            'Add preselect_orders (192K orders) to order detection',
            'Call POST /api/orders/reserve on order create',
            'Call POST /api/orders/ship on fulfillment â†’ store cost_unit',
            'Call POST /api/orders/cancel on cancellation',
            'Store SERP responses (picking_id, stock_move_id, cost_unit) on items, component_orders, and preselect_orders',
          ],
          tasks: [
            {
              name: 'Expand order detection to all ec_order types + preselect_orders',
              owner: 'Laravel Devs',
              startWeek: 1,
              duration: 2,
            },
            {
              name: 'Add receiver product mapping (items.product_sku â†’ reserve)',
              owner: 'Laravel Devs',
              startWeek: 2,
              duration: 1,
            },
            {
              name: 'Parallel run with all order types + stabilization',
              owner: 'Laravel Devs',
              startWeek: 3,
              duration: 2,
            },
          ],
          workflow: [
            { laravel: 'Detect ALL new ec_orders + preselect_orders', odoo: 'â€”' },
            { laravel: 'POST /api/orders/reserve â†’ store picking_id, stock_move_id', odoo: 'â€”' },
            { laravel: 'POST /api/orders/ship â†’ store cost_unit', odoo: 'â€”' },
            { laravel: 'POST /api/orders/cancel â†’ release reservations', odoo: 'â€”' },
          ],
          dataOwnership: [
            { data: 'All ec_order + preselect_orders inventory', laravel: 'Calls SERP APIs', odoo: 'â€”' },
            { data: 'items.stock_move_id + cost_unit', laravel: 'Stored from SERP response', odoo: 'â€”' },
            { data: 'component_orders.stock_move_id + cost_unit', laravel: 'Stored from SERP response', odoo: 'â€”' },
            { data: 'preselect_orders SERP columns', laravel: 'Stored from SERP response', odoo: 'â€”' },
          ],
          implementation: [
            '--- LARAVEL DEV SCOPE (just call the APIs) ---',
            'Remove merchandise_selections IS NOT NULL filter from order detection',
            'Add preselect_orders to order detection (same reserve/ship/cancel pattern)',
            'Map items.product_sku â†’ receiver_products for reserve calls',
            'Call same 3 SERP APIs built in Phase 1: /api/orders/reserve, /ship, /cancel',
            'Store responses: picking_id, stock_move_id, cost_unit on items, component_orders, preselect_orders',
            'SERP columns already exist on preselect_orders from Phase 2 migrations',
            '--- JACK OWNS (tested in Phase 6) ---',
            'SERP API correctness, FIFO math, COGS accuracy â€” all validated in Phase 6 parallel run',
            'High-volume load testing â€” Phase 6 parallel run covers full order volume',
          ],
          confirmations: [
            'Laravel dev - all order types call SERP APIs and store responses',
          ],
          keyPoint:
            'Laravel developer task (4 weeks, parallel with Phase 6). Just call the same 3 SERP APIs for ALL orders (ec_order + preselect_orders). SERP API correctness validated by Jack in Phase 6.',
        }
      ];

      // Migration events - Part 1 only includes events for phases 1, 2, 3, 5
      const migrationEvents = [
{
          phase: 4,
          week: 3,
          name: 'Import ALL Odoo Products into SERP â€” Laravel Dev',
          desc: 'Product management UI built in Weeks 1-2. Laravel Dev runs pre-built import scripts to bring ~3,900 missing Odoo products into SERP. Currently ~598 components exist (packaging only). Missing: raw materials, packed products, labels, cartons, gift sets, etc. Match by SKU (components.sku = product_product.default_code). Set odoo_id = "800" + component.id per existing convention. Without this, no BOM/MO/stock_quant migration can proceed.',
          tables: [
            'Odoo product_product (4,300 active storable with SKUs) â†’ import into SERP via product UI',
            'SKU matching: product_product.default_code = components.sku',
            'odoo_id convention: "800" + components.id (external reference, not Odoo internal ID)',
            'Map real Odoo product_product.id for migration FK references',
            '~160 Odoo products without SKUs skipped (junk/copies/freight)',
          ],
          color: '#9b59b6',
        },
{
          phase: 4,
          week: 6,
          name: 'Import MO/BOM/Location Data â€” Laravel Dev',
          desc: 'Laravel Dev runs migration scripts for manufacturing orders, normal BOMs (kit/phantom BOMs in Phase 5), and locations from Odoo. Product mapping already complete from Week 3.',
          tables: [
            'mrp_production (26K) â†’ SERP mrp_production',
            'mrp_bom (2K normal) â†’ SERP mrp_bom',
            'mrp_bom_line (6.5K) â†’ SERP mrp_bom_line',
            'mrp_unbuild (190) â†’ SERP mrp_unbuild',
            'stock_location (2.7K) â†’ SERP stock_location',
            'stock_picking_type (135) â†’ SERP stock_picking_type',
            'uom_category (7) + uom_uom (27) â†’ seed SERP tables',
          ],
          color: '#9b59b6',
        },
{
          phase: 6,
          week: 4,
          name: 'Test Inventory Import (Optional)',
          desc: 'Practice run: export Odoo inventory snapshot to validate import scripts. Data will be stale â€” for testing only.',
          tables: [
            'stock_quant (14K) - TEST ONLY',
            'stock_valuation_layer (sample active layers) - TEST ONLY',
            'Validate import scripts + mapping',
          ],
          color: '#ffc107',
        },
{
          phase: 6,
          week: 5,
          name: 'ðŸš¨ INVENTORY CUTOVER',
          desc: 'THE migration moment. Freeze Odoo, physical count, import current inventory, and backfill historical COGS on all old orders. This is the only time inventory data is imported for real. Only active FIFO layers migrated (not 13.4M historical records).',
          tables: [
            'stock_quant (14K) - LIVE â†’ SERP stock_quant',
            'stock_valuation_layer (~3.7K active layers, remaining_qty > 0) â†’ SERP stock_valuation_layer',
            'stock_scrap (1.4K) â†’ SERP stock_scrap',
            'stock_landed_cost (87) â†’ SERP stock_landed_cost',
            'stock_landed_cost_lines (88) â†’ SERP stock_landed_cost_lines',
            'Historical COGS backfill: Odoo SVL unit_cost â†’ items.cost_unit + component_orders.cost_unit (~2M orders, 13M SVL rows)',
          ],
          color: '#dc3545',
        },
{
          phase: 6,
          week: 6,
          name: 'Odoo Deprecated',
          desc: 'Validate inventory accuracy, reconcile counts with system, train warehouse team. Odoo becomes read-only archive.',
          tables: [
            'Physical count validation',
            'Book vs actual reconciliation',
            'Odoo â†’ read-only',
          ],
          color: '#dc3545',
        }
      ];

      function addDays(d, n) {
        const r = new Date(d);
        r.setDate(r.getDate() + n);
        return r;
      }
      function addWeeks(d, w) {
        return addDays(d, w * 7);
      }
      function fmt(d) {
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }
      function fmtFull(d) {
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }

      function calcSchedules() {
        const start = new Date(project.startDate);
        const ends = new Map();
        return phases.map((p) => {
          let s = start;
          p.deps.forEach((id) => {
            const e = ends.get(id);
            if (e && e > s) s = e;
          });
          const e = addWeeks(s, p.weeks);
          ends.set(p.id, e);
          return {
            phase: p,
            start: s,
            end: e,
            isParallel: p.parallelWith && p.parallelWith.length > 0,
          };
        });
      }

      function renderPhaseDetail(sched) {
        const p = sched.phase;
        const start = sched.start;
        let html = `<div class="phase-detail">
    <div class="phase-header" style="border-left-color:${p.color}" onclick="togglePhase(${p.id})">
      <h2><span class="toggle">â–¶</span> Phase ${p.id}: ${p.name}</h2>
      <div class="phase-meta-info">${fmtFull(sched.start)} â†’ ${fmtFull(sched.end)} (${p.weeks} weeks)${sched.isParallel ? ' â€¢ Runs in parallel' : ''}</div>
      <div class="phase-goal-text">${p.goal}</div>
    </div>
    <div class="phase-content" id="phase-content-${p.id}">`;

        // Goals
        if (p.goals && p.goals.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Goals</h3><ul>`;
          p.goals.forEach((g) => (html += `<li>${g}</li>`));
          html += `</ul></div>`;
        }

        // Workflow
        html += `<div class="section"><h3 style="border-color:${p.color}">How It Works</h3>`;
        if (Array.isArray(p.workflow)) {
          html += `<table class="workflow-table"><tr><th>SERP (Laravel)</th><th style="width:40px"></th><th>Odoo</th></tr>`;
          p.workflow.forEach((row) => {
            if (row.laravel.startsWith('---')) {
              const headerText = row.laravel.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
              html += `<tr><td colspan="3" style="background:${p.color}15;color:${p.color};font-weight:600;text-align:center;padding:12px;border-top:2px solid ${p.color}">${headerText}</td></tr>`;
            } else {
              const rowClass = row.sync ? 'sync-row' : '';
              const arrow = row.sync ? 'â†’' : '';
              html += `<tr class="${rowClass}"><td>${row.laravel}</td><td class="arrow">${arrow}</td><td>${row.odoo}</td></tr>`;
            }
          });
          html += `</table>`;
        } else {
          Object.entries(p.workflow).forEach(([header, rows]) => {
            html += `<h4>${header}</h4><table class="workflow-table"><tr><th>SERP (Laravel)</th><th style="width:40px"></th><th>Odoo</th></tr>`;
            rows.forEach((row) => {
              if (row.laravel.startsWith('---')) {
                const headerText = row.laravel.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
                html += `<tr><td colspan="3" style="background:${p.color}15;color:${p.color};font-weight:600;text-align:center;padding:12px">${headerText}</td></tr>`;
              } else {
                const rowClass = row.sync ? 'sync-row' : '';
                const arrow = row.sync ? 'â†’' : '';
                html += `<tr class="${rowClass}"><td>${row.laravel}</td><td class="arrow">${arrow}</td><td>${row.odoo}</td></tr>`;
              }
            });
            html += `</table>`;
          });
        }
        if (p.keyPoint)
          html += `<div class="highlight" style="border-color:${p.color}"><strong>${p.keyPoint}</strong></div>`;
        html += `</div>`;

        // Data Ownership
        html += `<div class="section"><h3 style="border-color:${p.color}">Data Ownership</h3>`;
        html += `<table><tr><th>Data</th><th>SERP</th><th>Odoo</th></tr>`;
        p.dataOwnership.forEach((row) => {
          const laravelClass = row.laravel.includes('Owner') ? 'owner-cell' : 'copy-cell';
          const odooClass = row.odoo.includes('Owner') ? 'owner-cell' : 'copy-cell';
          html += `<tr><td>${row.data}</td><td class="${laravelClass}">${row.laravel}</td><td class="${odooClass}">${row.odoo}</td></tr>`;
        });
        html += `</table></div>`;

        // Implementation
        html += `<div class="section"><h3 style="border-color:${p.color}">Implementation Details</h3>`;
        if (Array.isArray(p.implementation)) {
          html += `<ul>`;
          p.implementation.forEach((item) => {
            if (item.startsWith('---') && item.endsWith('---')) {
              const headerText = item.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
              html += `</ul><h4 style="margin-top:20px;color:${p.color}">${headerText}</h4><ul>`;
            } else {
              html += `<li>${item}</li>`;
            }
          });
          html += `</ul>`;
        } else {
          Object.entries(p.implementation).forEach(([header, items]) => {
            html += `<h4>${header}</h4><ul>`;
            items.forEach((item) => {
              if (item.startsWith('---')) {
                const headerText = item.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
                html += `</ul><h4 style="color:${p.color}">${headerText}</h4><ul>`;
              } else {
                html += `<li>${item}</li>`;
              }
            });
            html += `</ul>`;
          });
        }
        html += `</div>`;

        // Cutover Checklist
        if (p.cutoverChecklist && p.cutoverChecklist.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Cutover Checklist</h3><ul>`;
          p.cutoverChecklist.forEach((item) => (html += `<li>â˜ ${item}</li>`));
          html += `</ul></div>`;
        }

        // Confirmations
        if (p.confirmations && p.confirmations.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Team Confirmations Before Launch</h3><ul>`;
          p.confirmations.forEach((item) => (html += `<li>${item}</li>`));
          html += `</ul></div>`;
        }

        // Timeline
        html += `<div class="section"><h3 style="border-color:${p.color}">Timeline</h3>`;
        html += `<div class="gantt-container"><div class="gantt-header"><div class="gantt-label">Task</div><div class="gantt-weeks">`;
        for (let w = 1; w <= p.weeks; w++) {
          const weekStart = addDays(start, (w - 1) * 7);
          html += `<div class="week-col">W${w}<br><span class="week-dates">${fmt(weekStart)}</span></div>`;
        }
        html += `</div></div>`;
        const ownerColors = { Jack: '#3498db', 'Laravel Devs': '#e67e22', 'Laravel Dev': '#e67e22', Both: '#8e44ad' };
        const ownerBg = { Jack: '#ebf5fb', 'Laravel Devs': '#fef5e7', 'Laravel Dev': '#fef5e7', Both: '#f4ecf7' };
        let lastOwner = null;
        p.tasks.forEach((task) => {
          if (task.owner && task.owner !== lastOwner) {
            lastOwner = task.owner;
            const oc = ownerColors[task.owner] || p.color;
            const ob = ownerBg[task.owner] || '#f8f9fa';
            html += `<div class="gantt-row" style="min-height:28px;background:${ob};border-top:2px solid ${oc}">`;
            html += `<div class="task-label" style="font-weight:700;color:${oc};font-size:0.9em">${task.owner}</div>`;
            html += `<div class="task-track" style="background:${ob}"></div></div>`;
          }
          const left = ((task.startWeek - 1) / p.weeks) * 100;
          const width = (task.duration / p.weeks) * 100;
          const barColor = ownerColors[task.owner] || p.color;
          const ownerBadge = task.owner ? `<span style="display:inline-block;background:${barColor};color:#fff;border-radius:3px;padding:1px 6px;font-size:0.75em;margin-right:6px;white-space:nowrap">${task.owner}</span>` : '';
          html += `<div class="gantt-row"><div class="task-label">${ownerBadge}${task.name}</div>`;
          html += `<div class="task-track">${Array(p.weeks).fill('<div class="task-cell"></div>').join('')}`;
          html += `<div class="task-bar" style="left:${left}%;width:${width}%;background:${barColor}">${task.owner ? task.owner + ' Â· ' : ''}${task.duration}w</div></div></div>`;
        });
        html += `</div></div>`;

        html += `</div></div>`;
        return html;
      }

      function togglePhase(id) {
        const content = document.getElementById(`phase-content-${id}`);
        const header = content.previousElementSibling;
        content.classList.toggle('hide');
        header.classList.toggle('collapsed');
      }

      function render() {
        const scheds = calcSchedules();
        const start = new Date(project.startDate);
        const end = scheds.reduce((max, s) => s.end > max ? s.end : max, scheds[0].end);

        document.getElementById('meta').textContent =
          `${fmtFull(start)} â†’ ${fmtFull(end)} | ${project.preparedBy}`;

        const totalWeeks = Math.ceil((end - start) / (7 * 24 * 60 * 60 * 1000));
        const totalTasks = phases.reduce((s, p) => s + p.tasks.length, 0);
        document.getElementById('summary').innerHTML = `
    <div class="summary-card"><div class="value">${phases.length}</div><div class="label">Phases</div></div>
    <div class="summary-card"><div class="value">${totalWeeks}</div><div class="label">Weeks</div></div>
    <div class="summary-card"><div class="value">${totalTasks}</div><div class="label">Tasks</div></div>
    <div class="summary-card"><div class="value">${fmt(end)}</div><div class="label">Target</div></div>
  `;

        const months = [];
        let cur = new Date(start);
        while (cur <= end) {
          months.push(cur.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));
          cur = new Date(cur.getFullYear(), cur.getMonth() + 1, 1);
        }
        document.getElementById('months').innerHTML = months
          .map((m) => `<div class="month-col">${m}</div>`)
          .join('');

        const totalDays = (end - start) / (24 * 60 * 60 * 1000);
        document.getElementById('timeline').innerHTML = scheds
          .map((s) => {
            const left = ((s.start - start) / (24 * 60 * 60 * 1000) / totalDays) * 100;
            const width = ((s.end - s.start) / (24 * 60 * 60 * 1000) / totalDays) * 100;
            const parallelLabel = s.isParallel ? ' âˆ¥' : '';
            return `<div class="phase-row">
      <div class="phase-label">Phase ${s.phase.id}: ${s.phase.shortName}${parallelLabel}</div>
      <div class="phase-track">
        <div class="phase-bar" style="left:${left}%;width:${width}%;background:${s.phase.color}">
          <span>${s.phase.name}</span>
          <span class="phase-dates">${fmt(s.start)} â†’ ${fmt(s.end)}</span>
        </div>
      </div>
    </div>`;
          })
          .join('');

        // Render migration events with calculated dates
        document.getElementById('migration-events').innerHTML = migrationEvents
          .map((evt) => {
            const phaseSched = scheds.find((s) => s.phase.id === evt.phase);
            const eventDate = addDays(phaseSched.start, (evt.week - 1) * 7);
            return `<div class="migration-event">
      <div class="migration-event-phase" style="color:${evt.color}">Phase ${evt.phase}</div>
      <div class="migration-event-week">Week ${evt.week}<br><span style="font-size:0.8em">${fmt(eventDate)}</span></div>
      <div class="migration-event-info">
        <div class="migration-event-name">${evt.name}</div>
        <div class="migration-event-desc">${evt.desc}</div>
        <div class="migration-event-tables">${evt.tables.map((t) => `<code>${t}</code>`).join('')}</div>
      </div>
    </div>`;
          })
          .join('');

        document.getElementById('milestones').innerHTML = scheds
          .map(
            (s) => `
    <div class="milestone-item">
      <div class="milestone-dot" style="background:${s.phase.color}"></div>
      <div class="milestone-info">
        <div class="milestone-name">${s.phase.milestone}</div>
        <div class="milestone-phase">Phase ${s.phase.id}</div>
      </div>
      <div class="milestone-date">${fmtFull(s.end)}</div>
    </div>
  `
          )
          .join('');

        document.getElementById('phases-detail').innerHTML = scheds
          .map((s) => renderPhaseDetail(s))
          .join('');
      }

      render();
    </script>
  </body>
</html>
