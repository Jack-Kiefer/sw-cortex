<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odoo Migration Planner</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f8f9fa;
        color: #333;
        line-height: 1.6;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 30px;
      }
      h1 {
        color: #212529;
        font-size: 1.8em;
      }
      .meta {
        color: #6c757d;
        font-size: 0.9em;
      }
      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }
      .summary-card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .summary-card .value {
        font-size: 2em;
        font-weight: 700;
        color: #198754;
      }
      .summary-card .label {
        color: #6c757d;
        font-size: 0.85em;
        margin-top: 5px;
      }
      .timeline-container {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .timeline-header {
        display: flex;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .timeline-label {
        width: 220px;
        font-weight: 600;
        color: #495057;
        font-size: 0.9em;
      }
      .timeline-months {
        display: flex;
        flex: 1;
      }
      .month-col {
        flex: 1;
        text-align: center;
        font-size: 0.8em;
        font-weight: 600;
        color: #495057;
        padding: 8px 4px;
        border-left: 1px solid #e9ecef;
        background: #f8f9fa;
      }
      .month-col:first-child {
        border-left: none;
      }
      .phase-row {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }
      .phase-label {
        width: 220px;
        font-weight: 500;
        font-size: 0.9em;
        color: #495057;
      }
      .phase-track {
        flex: 1;
        height: 44px;
        position: relative;
        display: flex;
        align-items: center;
        background: #f8f9fa;
        border-radius: 6px;
      }
      .phase-bar {
        position: absolute;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 12px;
        font-size: 0.8em;
        font-weight: 500;
        color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }
      .phase-dates {
        font-size: 0.75em;
        opacity: 0.9;
      }
      .phase-detail {
        background: #fff;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
        overflow: hidden;
      }
      .phase-header {
        padding: 24px;
        border-left: 5px solid;
        cursor: pointer;
        transition: background 0.2s;
      }
      .phase-header:hover {
        background: #f8f9fa;
      }
      .phase-header h2 {
        font-size: 1.3em;
        margin-bottom: 8px;
        color: #212529;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .phase-header h2 .toggle {
        font-size: 0.8em;
        color: #6c757d;
        transition: transform 0.2s;
        transform: rotate(90deg);
      }
      .phase-header.collapsed h2 .toggle {
        transform: rotate(0deg);
      }
      .phase-meta-info {
        color: #6c757d;
        font-size: 0.9em;
        margin-bottom: 12px;
      }
      .phase-goal-text {
        background: #f8f9fa;
        padding: 14px;
        border-radius: 8px;
        color: #495057;
        font-size: 0.95em;
      }
      .phase-content {
        display: block;
        padding: 0 24px 24px;
        border-top: 1px solid #e9ecef;
      }
      .phase-content.hide {
        display: none;
      }
      .section {
        margin-top: 24px;
      }
      .section h3 {
        font-size: 1.05em;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 2px solid;
        color: #495057;
      }
      .section h4 {
        font-size: 0.95em;
        margin: 16px 0 8px;
        color: #495057;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 12px 0;
        font-size: 0.9em;
      }
      th,
      td {
        padding: 10px 12px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
      }
      th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
      }
      .owner-cell {
        color: #198754;
        font-weight: 600;
      }
      .copy-cell {
        color: #6c757d;
      }
      .workflow-table th:first-child {
        background: #e8f5e9;
        color: #198754;
      }
      .workflow-table th:last-child {
        background: #f3e5f5;
        color: #7b1fa2;
      }
      .workflow-table .sync-row {
        background: #fff3cd;
      }
      .workflow-table .arrow {
        text-align: center;
        color: #6c757d;
      }
      ul {
        margin: 8px 0;
        padding-left: 24px;
      }
      li {
        margin: 6px 0;
      }
      .highlight {
        background: #fff3cd;
        padding: 12px 16px;
        border-left: 4px solid;
        margin: 16px 0;
        font-weight: 500;
      }
      code {
        background: #f1f3f5;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.85em;
      }
      .gantt-container {
        overflow-x: auto;
        margin-top: 16px;
      }
      .gantt-header {
        display: flex;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 8px;
        min-width: 800px;
      }
      .gantt-label {
        width: 280px;
        min-width: 280px;
        padding: 10px;
        font-weight: 600;
        color: #495057;
        font-size: 0.85em;
      }
      .gantt-weeks {
        display: flex;
        flex: 1;
      }
      .week-col {
        flex: 1;
        text-align: center;
        padding: 8px 4px;
        font-size: 0.75em;
        font-weight: 600;
        color: #495057;
        border-left: 1px solid #e9ecef;
        background: #f8f9fa;
      }
      .week-col:first-child {
        border-left: none;
      }
      .week-dates {
        font-size: 0.7em;
        color: #6c757d;
        font-weight: 400;
      }
      .gantt-row {
        display: flex;
        align-items: center;
        min-height: 36px;
        border-bottom: 1px solid #f1f3f5;
        min-width: 800px;
      }
      .gantt-row:hover {
        background: #f8f9fa;
      }
      .task-label {
        width: 280px;
        min-width: 280px;
        padding: 6px 10px;
        font-size: 0.85em;
        color: #495057;
      }
      .task-track {
        display: flex;
        flex: 1;
        position: relative;
        height: 26px;
      }
      .task-cell {
        flex: 1;
        border-left: 1px solid #f1f3f5;
      }
      .task-cell:first-child {
        border-left: none;
      }
      .task-bar {
        position: absolute;
        height: 20px;
        top: 3px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7em;
        font-weight: 500;
        color: white;
      }
      .milestones {
        background: #fff;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .milestones h3 {
        margin-bottom: 20px;
        color: #495057;
        font-size: 1.1em;
      }
      .milestone-item {
        display: flex;
        align-items: center;
        padding: 14px 0;
        border-bottom: 1px solid #e9ecef;
      }
      .milestone-item:last-child {
        border-bottom: none;
      }
      .milestone-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 15px;
      }
      .milestone-info {
        flex: 1;
      }
      .milestone-name {
        font-weight: 500;
        color: #212529;
      }
      .milestone-phase {
        font-size: 0.85em;
        color: #6c757d;
      }
      .milestone-date {
        font-weight: 600;
        color: #198754;
      }
      .migration-events {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
      }
      .migration-events h3 {
        margin-bottom: 5px;
        color: #495057;
      }
      .migration-event {
        display: flex;
        align-items: flex-start;
        padding: 12px 0;
        border-bottom: 1px solid #f1f3f5;
      }
      .migration-event:last-child {
        border-bottom: none;
      }
      .migration-event-phase {
        width: 100px;
        min-width: 100px;
        font-weight: 600;
        font-size: 0.85em;
      }
      .migration-event-week {
        width: 80px;
        min-width: 80px;
        color: #6c757d;
        font-size: 0.85em;
      }
      .migration-event-info {
        flex: 1;
      }
      .migration-event-name {
        font-weight: 600;
        margin-bottom: 4px;
      }
      .migration-event-desc {
        color: #6c757d;
        font-size: 0.85em;
      }
      .migration-event-tables {
        margin-top: 6px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .migration-event-tables code {
        background: #e9ecef;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75em;
      }
      @media print {
        .phase-content {
          display: block !important;
        }
        .phase-header {
          break-after: avoid;
        }
        .phase-detail {
          break-inside: avoid;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div>
          <h1>Odoo to SERP Migration Plan</h1>
          <div class="meta" id="meta"></div>
        </div>
      </header>
      <div class="summary-cards" id="summary"></div>
      <div class="timeline-container">
        <div class="timeline-header">
          <div class="timeline-label">Phase</div>
          <div class="timeline-months" id="months"></div>
        </div>
        <div id="timeline"></div>
        <div style="margin-top: 12px; font-size: 0.8em; color: #6c757d">
          <strong>‚à•</strong> = Phases run in parallel
        </div>
      </div>
      <div class="migration-events">
        <h3>üì¶ Data Migration Timeline</h3>
        <p style="color: #6c757d; font-size: 0.9em; margin-bottom: 15px">
          When Odoo data gets imported into SERP tables
        </p>
        <div id="migration-events"></div>
      </div>
      <div class="milestones">
        <h3>Key Milestones</h3>
        <div id="milestones"></div>
      </div>
      <h2 style="margin: 30px 0 20px; color: #495057; font-size: 1.3em">Phase Details</h2>
      <div id="phases-detail"></div>
      <!-- Future Improvements -->
      <div class="phase-detail" style="margin-top: 40px">
        <div
          class="phase-header"
          style="border-left-color: #6c757d"
          onclick="togglePhase('future')"
        >
          <h2><span class="toggle">‚ñ∂</span> Future Improvements</h2>
          <div class="phase-meta-info">Features not currently in Odoo ‚Äî to be built as needed</div>
          <div class="phase-goal-text">
            These are <strong>new capabilities</strong> that don't exist in Odoo today. They can be
            built in SERP independently of the core migration phases, prioritized by business need.
          </div>
        </div>
        <div class="phase-content" id="phase-content-future">
          <div class="section">
            <h3 style="border-color: #6c757d">Why These Are Separate</h3>
            <div class="highlight" style="border-color: #0d6efd; background: #e3f2fd">
              <strong>These features don't exist in Odoo.</strong> The main migration phases focus
              on replacing existing Odoo functionality. These improvements are net-new capabilities
              that can be built on-demand.
            </div>
          </div>
          <div class="section">
            <h3 style="border-color: #6c757d">Available Improvements</h3>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #198754;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">Blanket PO Tracking</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Track long-term vendor agreements with multiple releases. SERP manages the
                agreement, Odoo receives individual release POs.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Create Agreement:</strong> Blanket PO in SERP with total qty, price terms,
                  validity period
                </li>
                <li>
                  <strong>Release Orders:</strong> Each release creates a real purchase.order in
                  Odoo
                </li>
                <li>
                  <strong>Track Usage:</strong> SERP tracks total released vs. agreement amount
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> No native blanket/framework PO support exists.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #fd7e14;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">PO Approval Workflows</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Route POs for approval based on amount thresholds. Notify via Slack, update Odoo
                when approved.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Threshold Rules:</strong> POs over $X need manager, over $Y need director
                </li>
                <li>
                  <strong>Multi-Step:</strong> Ops approval first, then Finance for larger amounts
                </li>
                <li>
                  <strong>Slack Integration:</strong> Approver receives Slack message with
                  approve/reject buttons
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> studio_approval_rule exists but has 0 active rules
                configured.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #dc3545;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">
                Supplier Forecast ‚Üí Odoo Integration
              </h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Turn SERP supplier forecasts into draft POs in Odoo with one click.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li>
                  <strong>Generate:</strong> Supplier Forecast calculates what to order based on
                  demand
                </li>
                <li><strong>Review:</strong> User reviews and adjusts suggested quantities</li>
                <li>
                  <strong>Push:</strong> Click "Send to Odoo" to create draft purchase.order records
                </li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> Odoo has no forecasting integration. Tool exists
                in SERP already.
              </div>
            </div>
            <div
              style="
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 16px 0;
                border-left: 4px solid #6f42c1;
              "
            >
              <h4 style="margin: 0 0 12px 0; color: #212529">Inventory Adjustment Approvals</h4>
              <p style="margin: 0 0 12px 0; color: #495057">
                Require approval for manual inventory adjustments above a threshold.
              </p>
              <ul style="color: #495057; font-size: 0.9em">
                <li><strong>Request:</strong> User submits adjustment with reason code</li>
                <li><strong>Threshold Check:</strong> Large adjustments require approval</li>
                <li><strong>Audit Trail:</strong> Log who requested, who approved, and why</li>
              </ul>
              <div
                style="
                  margin-top: 12px;
                  padding: 8px 12px;
                  background: #fff3cd;
                  border-radius: 4px;
                  font-size: 0.85em;
                "
              >
                <strong>Why not in Odoo:</strong> Odoo allows direct adjustments with no approval
                gate.
              </div>
            </div>
          </div>
          <div class="section">
            <h3 style="border-color: #6c757d">Other Potential Improvements</h3>
            <p style="margin-bottom: 16px; color: #6c757d">
              Additional features discussed but not yet prioritized:
            </p>
            <ul>
              <li>
                <strong>Bulk BOM Import:</strong> Import BOMs from spreadsheet with validation
              </li>
              <li>
                <strong>Product/BOM Archiving:</strong> Soft-delete with archive flag instead of
                hard delete
              </li>
              <li>
                <strong>Warehouse Location Tracking:</strong> Track inventory by pallet/location
                within warehouse
              </li>
              <li>
                <strong>Bulk Inventory Adjustments:</strong> Adjust multiple items at once from
                spreadsheet
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <script src="phase.html" type="text/javascript"></script>
    <script>
      // Use phases data from phase.html (it's embedded in that file)
      // We'll inline the complete phases array here
    </script>
    <script>
      const PROJECT_START = '2026-02-09';
      const project = { startDate: PROJECT_START, preparedBy: 'Jack Kiefer' };

      // Complete phases data from phase.html
      const phases = [
        {
          id: 1,
          name: 'Custom Branding Infrastructure',
          shortName: 'Branding',
          weeks: 7,
          deps: [],
          color: '#e67e22',
          milestone: 'Custom Branding Inventory Live',
          goal: 'Complete SERP infrastructure (most tables already exist from migrations 001-010). Add odoo_component_id to purchase_order_line, create odoo_sync_queue, build services. Test with custom branding products (odoo_component_id=NULL). Single unified system.',
          goals: [
            '‚úÖ Tables already exist (migrations 001-010): purchase_orders, lines, suppliers, bills, stock_quant, stock_move, etc.',
            'Add odoo_component_id to purchase_order_line (NULL=SERP-only, populated=sync) - NEW COLUMN',
            'Create odoo_sync_queue table for async Odoo syncs - NEW TABLE',
            'Build PO services: create, receive, bill creation (reusable code)',
            'Build inventory services: adjust, deduct, FIFO consumption (reusable code)',
            'Build order processing workflow: ec_order ‚Üí component_orders ‚Üí stock_move ‚Üí ship',
            'Build component inventory view: aggregate stock_quant (reserved + on-hand)',
            'Build line-level Odoo sync logic (sync only lines where odoo_component_id IS NOT NULL)',
            'Test complete custom branding workflow end-to-end',
          ],
          tasks: [
            {
              name: 'Add odoo_component_id column + create odoo_sync_queue table',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Build PO services (create, send, receive, bill)',
              startWeek: 2,
              duration: 2,
            },
            {
              name: 'Build inventory services (adjust, reserve, deduct, FIFO)',
              startWeek: 2,
              duration: 2,
            },
            {
              name: 'Build line-level sync service + component_inventory VIEW',
              startWeek: 4,
              duration: 1,
            },
            {
              name: 'Build custom branding order workflow (ec_order ‚Üí component_orders)',
              startWeek: 4,
              duration: 2,
            },
            {
              name: 'Build UI: components, POs, inventory adjustments',
              startWeek: 5,
              duration: 2,
            },
            {
              name: 'E2E validation: create products, test PO + order workflow',
              startWeek: 7,
              duration: 1,
            },
          ],
          workflow: [
            { laravel: '--- UNIFIED INFRASTRUCTURE (single code path) ---', odoo: '---' },
            {
              laravel: 'Create component with odoo_product_id=NULL (custom branding)',
              odoo: '‚Äî',
            },
            { laravel: 'Create supplier (odoo_partner_id=NULL in Phase 1)', odoo: '‚Äî' },
            {
              laravel: 'Create PO with line: component_id=X, odoo_component_id=NULL',
              odoo: '‚Äî',
            },
            { laravel: 'Receive PO arrival ‚Üí update stock_quant', odoo: '‚Äî' },
            {
              laravel: 'Sync check per line: if odoo_component_id IS NOT NULL ‚Üí sync',
              odoo: '‚Äî',
            },
            {
              laravel: 'Custom branding lines: odoo_component_id=NULL ‚Üí skip sync',
              odoo: '‚Äî',
            },
            {
              laravel: 'Odoo lines (Phase 2): odoo_component_id populated ‚Üí sync',
              odoo: 'Receive PO sync',
            },
            {
              laravel: 'Mixed POs: sync ONLY lines where odoo_component_id IS NOT NULL',
              odoo: 'Partial sync',
            },
            { laravel: 'Create bill manually after vendor invoice received', odoo: '‚Äî' },
            { laravel: 'Order fulfillment ‚Üí consume FIFO layers, deduct inventory', odoo: '‚Äî' },
            { laravel: '--- LINE-LEVEL SYNC CONTROL (odoo_component_id) ---', odoo: '---' },
          ],
          dataOwnership: [
            { data: 'Custom branding components', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Custom branding inventory (stock_quant)', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Custom branding inventory moves', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Custom branding COGS', laravel: 'Owner', odoo: '‚Äî' },
          ],
          dbChanges: [
            {
              table: '‚úÖ EXISTING TABLES (Migrations 001-010 Already Built)',
              purpose:
                'Most infrastructure already exists! Tables below are from existing migrations.',
              columns: 'See alembic/versions/001-010 for complete schemas',
            },
            {
              table: 'components (‚úÖ EXISTS)',
              purpose:
                'ALL components - custom branding + future Odoo components. Single unified table.',
              columns:
                'name, sku, unit_cost, odoo_product_id (already exists - NULL for custom branding)',
            },
            {
              table: 'suppliers',
              purpose:
                'Vendor management - used for custom branding POs in Phase 1, links to Odoo partners in Phase 2',
              columns:
                'name, email, phone, odoo_partner_id (NULL in Phase 1), supplier_rank, vat, address fields',
            },
            {
              table: 'locations',
              purpose:
                'SERP warehouse facilities - will link to Odoo warehouse/location IDs in Phase 2',
              columns:
                'name, odoo_warehouse_id (NULL in Phase 1), odoo_location_id (NULL in Phase 1), active',
            },
            {
              table: 'purchase_orders',
              purpose:
                'ALL purchase orders - single PO system for custom branding (Phase 1) + Odoo POs (Phase 2)',
              columns:
                'name, supplier_id, state (draft‚Üísent‚Üípurchase‚Üídone), invoice_status, amount_*, date_order, date_planned, effective_date, odoo_id (NULL for SERP-native POs)',
            },
            {
              table: 'purchase_order_line',
              purpose:
                'PO line items with quantity tracking. Sync to Odoo controlled at LINE level via odoo_component_id.',
              columns:
                'purchase_order_id, component_id (FK to components), odoo_component_id (NULL=SERP-only, populated=sync to Odoo), product_qty (ordered), qty_received, qty_invoiced, price_unit',
            },
            {
              table: 'stock_quant',
              purpose:
                '‚≠ê INVENTORY TRUTH - current on-hand qty per product/location. Used by ALL components.',
              columns: 'component_id, location_id, quantity, reserved_quantity, in_date, unit_cost',
            },
            {
              table: 'stock_picking',
              purpose:
                'Warehouse operations (receipts, deliveries, transfers) - groups stock_moves',
              columns:
                'name (WH/IN/00123), origin (PO#), location_id‚Üílocation_dest_id, state (draft‚Üíassigned‚Üídone), picking_type_id',
            },
            {
              table: 'stock_picking_type',
              purpose: 'Define operation types - how receipts, deliveries, transfers behave',
              columns:
                'name, code (incoming/outgoing/internal/mrp), default_location_src/dest_id, reservation_method',
            },
            {
              table: 'stock_move',
              purpose:
                'Individual inventory movements - move X units from A to B. Only state=done updates inventory',
              columns:
                'product_uom_qty (requested), quantity_done (actual), state, picking_id, location_id‚Üílocation_dest_id, component_id',
            },
            {
              table: 'stock_move_line',
              purpose: 'Detailed lines within stock_move - for lot/serial tracking',
              columns: 'move_id, qty_done, location_id‚Üílocation_dest_id',
            },
            {
              table: 'stock_valuation_layer',
              purpose:
                '‚≠ê FIFO COSTING - each receipt creates a layer; consumption decrements oldest first',
              columns:
                'component_id, quantity, unit_cost (from PO), remaining_qty (unconsumed), remaining_value (for GL), stock_move_id',
            },
            {
              table: 'stock_location',
              purpose: 'Hierarchical warehouse locations (bins, zones, areas)',
              columns:
                'name, complete_name (path), parent_id, usage (internal/supplier/customer), scrap_location, odoo_location_id (NULL in Phase 1)',
            },
            {
              table: 'account_journal',
              purpose:
                'Define journal types that categorize transactions (Vendor Bills, Inventory Valuation, etc.)',
              columns: 'name, code (BILL, STJ), type (purchase, sale, general), default_account_id',
            },
            {
              table: 'account_move',
              purpose:
                'Vendor bills - MANUAL creation after vendor invoice received (3-way matching)',
              columns:
                'name (bill #), ref (VENDOR invoice #), state (draft‚Üíposted), payment_state, amount_*, journal_id, odoo_id (NULL in Phase 1)',
            },
            {
              table: 'account_move_line',
              purpose: 'Bill line items linked to PO lines for line-level 3-way matching',
              columns:
                'move_id, quantity, price_unit, price_subtotal, purchase_line_id (FK to PO line!), component_id',
            },
            {
              table: 'account_move_purchase_order_rel',
              purpose: 'Junction table linking bills to POs (one bill can reference multiple POs)',
              columns: 'account_move_id, purchase_order_id',
            },
            {
              table: 'account_payment_term',
              purpose:
                'Payment term definitions (Net 30, 2% 10 Net 30, etc.) - SEEDED with 8 terms',
              columns: 'name, active, note, sequence ‚Äî seeded to match Odoo IDs',
            },
            {
              table: 'account_payment_term_line',
              purpose:
                'Payment schedule within terms (for split payments like 30% now, balance 60 days)',
              columns: 'payment_id, value (balance/percent/fixed), value_amount, days',
            },
            {
              table: 'mail_message (‚úÖ EXISTS)',
              purpose:
                'Activity log for POs, bills, receipts - tracks comments, notes, and system events (Odoo chatter)',
              columns:
                'model, res_id, message_type, subtype, subject, body, author_id, author_supplier_id',
            },
            {
              table: 'entity_field_change (‚úÖ EXISTS)',
              purpose:
                'Audit trail - tracks what changed, old value vs new value, linked to messages',
              columns:
                'message_id, field_name, old_value, new_value, old_value_numeric, new_value_numeric',
            },
            {
              table: 'entity_attachment (‚úÖ EXISTS)',
              purpose: 'File attachments on POs/bills (vendor invoices, shipping docs, etc.)',
              columns: 'model, res_id, name, file_type, file_size, url, description',
            },
            {
              table: 'message_subtype',
              purpose:
                'Predefined message types (created, updated, RFQ sent, goods received, etc.)',
              columns: 'name, description, entity_type, is_default ‚Äî seeded with PO/bill subtypes',
            },
            {
              table: 'odoo_sync_queue',
              purpose:
                '‚≠ê CORE INFRASTRUCTURE - async queue for Odoo syncs with retry, DLQ, circuit breaker. Skipped for is_serp_native components.',
              columns:
                'entity_type, entity_id, operation (create/update/delete), payload JSON, status (pending/processing/synced/failed/dlq), attempts, last_attempt_at, error_message',
            },
            {
              table: 'product_supplierinfo',
              purpose:
                'Supplier-specific pricing/lead times per product - critical for PO cost calculation',
              columns:
                'supplier_id, component_id, price, min_qty (MOQ), delay (lead time days), case_qty',
            },
            {
              table: 'procurement_group',
              purpose:
                'Groups related POs/pickings for traceability (links to origin sales orders)',
              columns:
                'name, move_type (direct/one), partner_id, sale_id ‚Äî created fresh in Phase 1',
            },
          ],
          implementation: [
            '--- TABLES (Most Already Exist from Migrations 001-010) ---',
            'Add NEW COLUMN: purchase_order_line.odoo_component_id (NULL=SERP-only, populated=sync)',
            'Add NEW TABLE: odoo_sync_queue (async queue with retry, DLQ, circuit breaker)',
            'All other tables already exist: components, purchase_orders, stock_quant, stock_move, etc.',
            '--- BUILD SERVICES (Reusable Code for All Phases) ---',
            'PO services: create, send, receive, bill creation',
            'Inventory services: adjust, reserve, deduct, FIFO consumption',
            'Sync service: line-level check (if odoo_component_id IS NOT NULL ‚Üí queue sync)',
            '--- CUSTOM BRANDING ORDER WORKFLOW ---',
            '1. Read ec_order.merchandise_selections JSON (custom product choices)',
            '2. Create component_orders records (bypass kit system)',
            '3. Reserve inventory: create stock_move with state=assigned',
            '4. On ship: consume FIFO layers, update stock_quant',
            '5. Handle cancellations: release reservations',
            '--- COMPONENT INVENTORY VIEW ---',
            'Create SQL VIEW: component_inventory',
            'Aggregates stock_quant: SUM(quantity), SUM(reserved_quantity) GROUP BY component_id',
            'Provides on-hand and reserved totals for UI',
            '--- LINE-LEVEL ODOO SYNC LOGIC ---',
            'For each purchase_order_line: if odoo_component_id IS NOT NULL ‚Üí queue sync',
            'Custom branding POs: all lines have odoo_component_id=NULL ‚Üí skip sync',
            'Odoo POs (Phase 2): lines have odoo_component_id populated ‚Üí trigger sync',
            'Mixed POs supported: sync ONLY lines where odoo_component_id IS NOT NULL',
            '--- UI COMPONENTS ---',
            'Components management: create/edit custom branding products',
            'PO management: create/receive/bill POs',
            'Inventory adjustments: manual adjustments with reason codes',
            'Inventory moves: view stock_move history per component',
            '--- END-TO-END TESTING ---',
            'Create custom branding products in components table',
            'Create POs for custom branding (odoo_component_id=NULL)',
            'Receive POs, validate FIFO costing',
            'Process custom branding orders: ec_order ‚Üí component_orders ‚Üí stock_move ‚Üí ship',
            'Validate inventory deductions, reservations, COGS',
            'Prove infrastructure works before migrating any Odoo data',
          ],
          confirmations: [
            'Custom branding team - product creation and inventory management',
            'Fulfillment team - order processing workflow',
            'Finance team - COGS calculation accuracy',
          ],
          keyPoint:
            'Phase 1 builds COMPLETE infrastructure (all tables, all services). Line-level sync control: odoo_component_id=NULL skips sync, populated syncs. Custom branding tests with NULL, Phase 3 populates field.',
        },
        {
          id: 2,
          name: 'Laravel Order Queue (Custom Branding)',
          shortName: 'Laravel Queue',
          weeks: 7,
          deps: [],
          parallelWith: [1],
          color: '#f39c12',
          milestone: 'Custom Branding Orders Auto-Process',
          goal: 'Laravel developer builds order queue processor that sends hooks to SERP when custom branding orders come in, ship, or cancel. Processes ONLY orders with merchandise_selections.',
          goals: [
            'Create serp_order_queue table in Laravel database',
            'Build OrderObserver to watch ec_order changes (filter: merchandise_selections only)',
            'Queue events: reserve (on create), ship (on ship_date), cancel (on cancelled)',
            'Build queue processor that calls SERP API endpoints',
            'Handle retry logic, failures, and write COGS back to Laravel',
          ],
          tasks: [
            {
              name: 'Create serp_order_queue table migration',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Build OrderObserver (filter: custom branding orders only)',
              startWeek: 2,
              duration: 1,
            },
            {
              name: 'Build queue processor command (calls SERP APIs)',
              startWeek: 3,
              duration: 2,
            },
            {
              name: 'Build retry/DLQ logic and COGS write-back',
              startWeek: 5,
              duration: 2,
            },
            {
              name: 'Integration testing with SERP + edge case handling',
              startWeek: 7,
              duration: 1,
            },
          ],
          workflow: [
            { laravel: 'ec_order created with merchandise_selections', odoo: '‚Äî' },
            { laravel: 'OrderObserver ‚Üí write to serp_order_queue (event: reserve)', odoo: '‚Äî' },
            { laravel: 'Queue processor polls queue every 30s', odoo: '‚Äî' },
            { laravel: 'Call SERP: POST /api/orders/reserve', odoo: '‚Äî' },
            { laravel: 'SERP returns picking_id ‚Üí write to ec_order.serp_picking_id', odoo: '‚Äî' },
            { laravel: 'Order ships ‚Üí write to serp_order_queue (event: ship)', odoo: '‚Äî' },
            { laravel: 'Call SERP: POST /api/orders/ship', odoo: '‚Äî' },
            { laravel: 'SERP returns COGS ‚Üí write to component_orders.cost_unit', odoo: '‚Äî' },
            { laravel: 'Order cancelled ‚Üí write to serp_order_queue (event: cancel)', odoo: '‚Äî' },
            { laravel: 'Call SERP: POST /api/orders/cancel ‚Üí releases reservations', odoo: '‚Äî' },
          ],
          dataOwnership: [
            { data: 'serp_order_queue', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'ec_order.serp_picking_id', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'component_orders.cost_unit', laravel: 'Owner (written by SERP)', odoo: '‚Äî' },
          ],
          dbChanges: [
            {
              table: 'serp_order_queue',
              purpose:
                'Queue for SERP inventory processing - filters for custom branding orders only',
              columns:
                'order_id, event_type (reserve/ship/cancel), payload JSON, status (pending/processing/completed/failed), attempts, last_error, processed_at',
            },
            {
              table: 'ec_order (modify)',
              purpose: 'Add link to SERP stock_picking for tracking',
              columns: 'serp_picking_id (FK to SERP stock_picking)',
            },
          ],
          implementation: [
            'Create serp_order_queue table with retry/DLQ columns',
            'Build OrderObserver: watch ec_order for changes',
            'Filter: only process if merchandise_selections IS NOT NULL (custom branding)',
            'On create: queue event_type=reserve with payload',
            'On ship_date change: queue event_type=ship',
            'On status=cancelled: queue event_type=cancel',
            'Build queue processor (Laravel command scheduled every 30s)',
            'Batch fetch pending queue items (LIMIT 100, FOR UPDATE SKIP LOCKED)',
            'Call SERP API based on event_type',
            'Handle responses: write serp_picking_id, write COGS to component_orders',
            'Retry logic: exponential backoff, move to failed after 5 attempts',
            'Slack alerts for failed queue items',
          ],
          confirmations: [
            'Custom branding team - orders process automatically',
            'Tech team - queue processor reliable and monitored',
          ],
          keyPoint:
            'Laravel developer task (parallel with Phase 1). Builds queue processor for CUSTOM BRANDING ONLY. Phase 6 expands to all orders.',
        },
        {
          id: 3,
          name: 'Purchase Orders & Bills',
          shortName: 'POs+Bills',
          weeks: 8,
          deps: [1, 2],
          color: '#198754',
          milestone: 'PO + Bill System Live',
          goal: 'Move all PO creation, arrivals, and vendor bills to SERP. Bills are created MANUALLY after vendor invoice received (not auto-generated). On arrival, push FULL PO (header + lines + receipt) to Odoo for inventory updates.',
          goals: [
            'Move purchase order management from Odoo to SERP',
            'Enable purchasing team to create, edit, and track POs in one place',
            'Automate inventory updates in Odoo when goods are received',
            'Preserve manual bill creation workflow (accountant creates bill after receiving vendor invoice)',
            'Implement 3-way matching: PO ‚Üí Receipt ‚Üí Vendor Invoice reconciliation',
          ],
          tasks: [
            {
              name: 'Import Odoo suppliers with odoo_partner_id mapping',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Import Odoo components with odoo_product_id populated',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Build Odoo XML-RPC sync service (activate sync queue)',
              startWeek: 2,
              duration: 1,
            },
            {
              name: 'Migrate existing PO data (1.8K POs + 16K lines + bills)',
              startWeek: 3,
              duration: 2,
            },
            {
              name: 'Build email supplier communication service',
              startWeek: 4,
              duration: 1,
            },
            {
              name: 'Train purchasing team on SERP PO workflow',
              startWeek: 5,
              duration: 1,
            },
            {
              name: 'Parallel run: purchasing uses SERP, validate sync',
              startWeek: 6,
              duration: 2,
            },
            {
              name: 'Cutover + stabilization',
              startWeek: 8,
              duration: 1,
            },
          ],
          workflow: [
            { laravel: 'Create PO (draft or sent) ‚Äî date_order captured', odoo: '‚Äî' },
            { laravel: 'Set date_planned (expected arrival date)', odoo: '‚Äî' },
            { laravel: 'Email supplier or download PO as PDF', odoo: '‚Äî' },
            { laravel: 'Dock receipt (no inventory update yet)', odoo: '‚Äî' },
            { laravel: 'Inspection ‚Üí assign warehouse location ‚Üí inventory receipt', odoo: '‚Äî' },
            {
              laravel: 'Inventory receipt: effective_date set, sync triggered',
              odoo: 'Push: PO header + lines + stock_picking (receipt) ‚Üí inventory updated',
              sync: true,
            },
            { laravel: 'Mark backorders for future arrival (accept or cancel later)', odoo: '‚Äî' },
            { laravel: '--- 3-WAY MATCHING WORKFLOW (bills in SERP) ---', odoo: '---' },
            {
              laravel: '1. System creates DRAFT BILL from receipt (qty_received √ó price_unit)',
              odoo: '‚Äî',
            },
            { laravel: '2. Vendor sends invoice externally (email/mail)', odoo: '‚Äî' },
            { laravel: '3. Accountant compares draft bill vs vendor invoice', odoo: '‚Äî' },
            { laravel: '4a. If match: Accountant finalizes bill ‚Üí state=posted', odoo: '‚Äî' },
            { laravel: '4b. If mismatch: Kick back to ops ‚Üí reconcile with vendor', odoo: '‚Äî' },
            { laravel: '5. Finalized bill stored in SERP with line-item detail', odoo: '‚Äî' },
          ],
          dataOwnership: [
            { data: 'Purchase orders', laravel: 'Owner', odoo: 'Created on arrival (for billing)' },
            { data: 'PO line items', laravel: 'Owner', odoo: 'Created on arrival (for billing)' },
            { data: 'Backorders', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Suppliers (156 vendors)', laravel: 'Owner', odoo: 'Mapping (partner_id)' },
            {
              data: 'Supplier-product links (which products from which supplier)',
              laravel: 'Owner',
              odoo: '‚Äî',
            },
            { data: 'Receiving inspection records', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Vendor bills', laravel: 'Owner', odoo: '‚Äî' },
            { data: 'Inventory quantities', laravel: '‚Äî', odoo: 'Owner (stock_quant)' },
          ],
          dbChanges: [
            {
              table: 'mail_message (‚úÖ EXISTS)',
              purpose:
                'Activity log for POs, bills, receipts - tracks comments, notes, and system events (Odoo chatter)',
              columns:
                'model, res_id, message_type, subtype, subject, body, author_id, author_supplier_id',
            },
            {
              table: 'entity_field_change (‚úÖ EXISTS)',
              purpose:
                'Audit trail - tracks what changed, old value vs new value, linked to messages',
              columns:
                'message_id, field_name, old_value, new_value, old_value_numeric, new_value_numeric',
            },
            {
              table: 'entity_attachment (‚úÖ EXISTS)',
              purpose: 'File attachments on POs/bills (vendor invoices, shipping docs, etc.)',
              columns: 'model, res_id, name, file_type, file_size, url, description',
            },
            {
              table: 'message_subtype',
              purpose:
                'Predefined message types (created, updated, RFQ sent, goods received, etc.)',
              columns: 'name, description, entity_type, is_default ‚Äî seeded with PO/bill subtypes',
            },
            {
              table: 'suppliers',
              purpose: 'Link SERP vendors to Odoo partners for bi-directional sync',
              columns:
                'odoo_partner_id (sync link), supplier_rank (priority 1=preferred), vat (tax ID), address fields',
            },
            {
              table: 'locations',
              purpose: 'Link SERP warehouse facilities to Odoo warehouse/location IDs',
              columns: 'odoo_warehouse_id, odoo_location_id, active',
            },
            {
              table: 'purchase_orders',
              purpose:
                'PO lifecycle tracking with Odoo-compatible workflow and THREE CRITICAL DATE FIELDS',
              columns: 'odoo_id, name, state (draft‚Üísent‚Üípurchase‚Üídone), invoice_status, amount_*',
            },
            {
              table: 'purchase_orders (dates)',
              purpose: '‚ö†Ô∏è THREE DATE FIELDS - understand the difference!',
              columns:
                'date_order (CREATED), date_planned (EXPECTED arrival), effective_date (ACTUAL arrival - USE FOR VARIANCE)',
            },
            {
              table: 'purchase_order_line',
              purpose: 'Line items with quantity tracking for partial receipts and billing',
              columns:
                'product_qty (ordered), qty_received (arrived), qty_invoiced (billed), price_unit',
            },
            {
              table: 'purchase_order_line (product links)',
              purpose: 'Dual-link products: SERP component_id + Odoo odoo_product_id for sync',
              columns: 'component_id (SERP FK), odoo_product_id (Odoo FK)',
            },
            {
              table: 'account_journal',
              purpose:
                'Define journal types that categorize transactions (Vendor Bills, Inventory Valuation, etc.)',
              columns: 'name, code (BILL, STJ), type (purchase, sale, general), default_account_id',
            },
            {
              table: 'account_move',
              purpose:
                'Vendor bills - MANUAL creation after vendor invoice received (3-way matching)',
              columns:
                'name (bill #), ref (VENDOR invoice #), state (draft‚Üíposted), payment_state, amount_*',
            },
            {
              table: 'account_move_line',
              purpose: 'Bill line items linked to PO lines for line-level 3-way matching',
              columns: 'quantity, price_unit, price_subtotal, purchase_line_id (FK to PO line!)',
            },
            {
              table: 'account_move_purchase_order_rel',
              purpose: 'Junction table linking bills to POs (one bill can reference multiple POs)',
              columns: 'account_move_id, purchase_order_id',
            },
            {
              table: 'account_payment_term',
              purpose:
                'Payment term definitions (Net 30, 2% 10 Net 30, etc.) - SEEDED with 8 terms',
              columns: 'name, active, note, sequence ‚Äî seeded to match Odoo IDs',
            },
            {
              table: 'account_payment_term_line',
              purpose:
                'Payment schedule within terms (for split payments like 30% now, balance 60 days)',
              columns: 'payment_id, value (balance/percent/fixed), value_amount, days',
            },
            {
              table: 'procurement_group',
              purpose:
                'Groups related POs/pickings for traceability (links to origin sales orders)',
              columns:
                'name, move_type (direct/one), partner_id, sale_id ‚Äî created fresh, not migrated',
            },
            {
              table: 'odoo_sync_queue',
              purpose:
                '‚≠ê CORE INFRASTRUCTURE - async queue for all Odoo syncs with retry, DLQ, circuit breaker',
              columns:
                'entity_type, entity_id, operation (create/update/delete), payload JSON, status (pending/processing/synced/failed/dlq), attempts, last_attempt_at, error_message',
            },
          ],
          implementation: [
            'Draft POs (save without sending to vendor)',
            'Two-stage arrival: dock receipt ‚Üí inspection ‚Üí inventory receipt',
            'On arrival: push FULL PO (header + lines) + stock_picking to Odoo ‚Äî accountants can then create bills',
            'Location assignment on receipt (which warehouse bin receives goods)',
            'Supplier communication via email and activity log (similar to Odoo)',
            'Backorder tracking: mark future arrivals, accept or cancel later',
            'Partial arrival with delta sync tracking',
            '--- ODOO SYNC QUEUE (core infrastructure for ALL phases) ---',
            '‚Ä¢ Async queue pattern: SERP writes locally first, then queues Odoo sync job',
            '‚Ä¢ Odoo sync MUST succeed: retry with exponential backoff (1s, 2s, 4s, 8s, max 5 min)',
            '‚Ä¢ Dead letter queue: after N failures, move to DLQ for manual review',
            '‚Ä¢ Sync status tracking: each record has sync_status (pending/synced/failed/retrying)',
            '‚Ä¢ Admin dashboard: view failed syncs, retry individual items, bulk retry',
            '‚Ä¢ Circuit breaker: if Odoo is down (5+ consecutive failures), pause queue and alert',
            '‚Ä¢ Reconciliation job: daily job compares SERP vs Odoo, flags discrepancies',
            '‚Ä¢ REUSED IN ALL PHASES: MO sync, adjustment sync, BOM sync, location sync, product sync',
            '--- END SYNC QUEUE ---',
            '--- THREE CRITICAL DATE FIELDS (understand the difference!) ---',
            '‚Ä¢ date_order: When PO was CREATED (auto-populated, audit trail)',
            '‚Ä¢ date_planned: EXPECTED arrival date (user-entered for planning)',
            '‚Ä¢ effective_date: ACTUAL arrival (NULL until goods received!) ‚Äî USE THIS FOR INVENTORY VARIANCE',
            'Migrates: 1,846 POs + 16,139 lines with qty_received/qty_invoiced status',
            'Data cleanup: audit over-receipted lines and cancelled POs with active moves',
            'Receipt validation with warehouse team before go-live',
            '--- MANUAL BILL WORKFLOW (bills in SERP) ---',
            'Draft bill created from receipt (qty_received √ó price_unit)',
            'Accountant receives vendor invoice separately (email/mail)',
            '3-way match: compare draft bill ‚Üî vendor invoice ‚Üî original PO',
            'If match: accountant finalizes bill',
            'If mismatch: ops reconciles with vendor before finalizing',
            'Bill tracks qty_invoiced vs qty_received for partial billing',
            'Migrates: 1,569 vendor bills from Odoo account_move',
          ],
          confirmations: [
            'Purchasing team - PO creation and editing workflow',
            'Warehouse team - receipt and inspection process',
            'Finance team - 3-way matching workflow (draft bill vs vendor invoice)',
            'Finance team - bill approval and finalization process',
          ],
          keyPoint:
            'POs + Bills in SERP. On arrival: push full PO + receipt to Odoo (for inventory). Bills created in SERP via 3-way matching. Use effective_date for actual arrival.',
        },
        {
          id: 4,
          name: 'Manufacturing, Adjustments, BOMs, Locations & Products',
          shortName: 'MO+Adj+BOMs+Loc+Prod',
          weeks: 10,
          deps: [3],
          parallelWith: [5],
          color: '#9b59b6',
          milestone: 'MO, Adjustments, BOMs, Locations & Products Live',
          goal: 'Build Odoo features in SERP. Users switch to SERP UI, which dual-writes to both Odoo (XML-RPC) and SERP tables (stock_quants). Incremental by feature.',
          goals: [
            'Build features in SERP that replicate Odoo functionality',
            'Users switch to SERP UI for each feature (stop using Odoo UI)',
            'Dual-write: SERP sends XML-RPC to Odoo AND updates SERP shadow tables',
            'stock_quants table is independent (no linkage to component/RM inventory yet)',
            'Incremental rollout: Manufacturing ‚Üí Adjustments ‚Üí BOMs ‚Üí Stock Locations ‚Üí Product Info',
            'Track COGS correctly throughout transition',
          ],
          tasks: [
            {
              name: 'Build MO UI, creation/tracking/completion/scrapping',
              startWeek: 1,
              duration: 2,
            },
            { name: 'Build inventory adjustments with COGS tracking', startWeek: 1, duration: 2 },
            { name: 'Build BOM management UI', startWeek: 2, duration: 2 },
            { name: 'Build stock_locations and location UI', startWeek: 3, duration: 2 },
            { name: 'Build product management UI with cost tracking', startWeek: 4, duration: 2 },
            { name: 'Migrate MOs, BOMs, locations, products from Odoo', startWeek: 5, duration: 2 },
            { name: 'Cutover MO: disable Odoo MO UI, SERP becomes SOT', startWeek: 7, duration: 1 },
            { name: 'Cutover adjustments + BOMs: disable Odoo UIs', startWeek: 8, duration: 1 },
            { name: 'Cutover locations + products: disable Odoo UIs', startWeek: 9, duration: 1 },
            {
              name: 'End-to-end testing, COGS validation, stabilization',
              startWeek: 10,
              duration: 1,
            },
          ],
          workflow: [
            {
              laravel: 'User performs action in SERP UI (stops using Odoo UI)',
              odoo: 'Odoo UI disabled for this feature',
            },
            {
              laravel: 'SERP dual-writes: XML-RPC to Odoo + update stock_quants',
              odoo: 'Receives sync, stays in sync',
              sync: true,
            },
            {
              laravel: 'stock_quants updated independently (not linked to component inventory)',
              odoo: '‚Äî',
            },
            { laravel: 'MO created/completed/scrapped in SERP', odoo: 'XML-RPC sync', sync: true },
            {
              laravel: 'Inventory adjustment in SERP + COGS tracking',
              odoo: 'XML-RPC sync',
              sync: true,
            },
            { laravel: 'BOM create/edit in SERP', odoo: 'XML-RPC sync', sync: true },
            { laravel: 'Location management in SERP', odoo: 'XML-RPC sync', sync: true },
            { laravel: 'Product management in SERP', odoo: 'XML-RPC sync', sync: true },
          ],
          dataOwnership: [
            { data: 'Manufacturing orders', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Inventory adjustments', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'BOMs (2,078 total)', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Stock locations', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            { data: 'Products (5,809)', laravel: 'UI + Owner', odoo: 'Synced via XML-RPC' },
            {
              data: 'stock_quants (shadow)',
              laravel: 'Owner (independent)',
              odoo: 'Has its own copy',
            },
            { data: 'component_inventory', laravel: 'Unchanged', odoo: '‚Äî' },
            { data: 'Valuation layers (COGS)', laravel: 'Owner', odoo: '‚Äî' },
          ],
          dbChanges: [
            {
              table: 'mrp_production',
              purpose: 'Track production orders with Odoo workflow (draft‚Üíconfirmed‚Üíprogress‚Üídone)',
              columns:
                'name, odoo_id, receiver_product_id (OUTPUT), state, bom_id, product_qty, qty_produced, location_src_id, location_dest_id',
            },
            {
              table: 'mrp_bom',
              purpose: 'BOM headers - define "recipes" (what components make a product)',
              columns:
                'code, product_id (OUTPUT), type (normal/phantom), consumption, active, odoo_bom_id',
            },
            {
              table: 'mrp_bom_line',
              purpose: 'BOM components - qty of each component needed per 1 unit of output',
              columns: 'bom_id, product_id (component), product_qty, sequence, odoo_bom_line_id',
            },
            {
              table: 'uom_category',
              purpose:
                'Unit of measure categories (Unit, Weight, Volume, etc.) - SEEDED with 7 categories',
              columns: 'name ‚Äî seeded to match Odoo IDs',
            },
            {
              table: 'uom_uom',
              purpose: 'Units of measure with conversion factors - SEEDED with 27 units',
              columns: 'name, category_id, factor, rounding, uom_type (reference/bigger/smaller)',
            },
            {
              table: 'stock_location',
              purpose:
                'Hierarchical warehouse locations (bins, zones, areas) - different from SERP "locations" table',
              columns:
                'name, complete_name (path), parent_id, usage (internal/supplier/customer), scrap_location',
            },
            {
              table: 'stock_picking_type',
              purpose: 'Define operation types - how receipts, deliveries, transfers behave',
              columns:
                'name, code (incoming/outgoing/internal/mrp), default_location_src/dest_id, reservation_method',
            },
            {
              table: 'stock_quant',
              purpose:
                '‚≠ê INVENTORY TRUTH - current on-hand qty per product/location. Available = quantity - reserved',
              columns:
                'component_id/receiver_product_id, location_id, quantity, reserved_quantity, in_date, unit_cost',
            },
            {
              table: 'stock_picking',
              purpose:
                'Warehouse operations (receipts, deliveries, transfers) - groups stock_moves',
              columns:
                'name (WH/IN/00123), origin (PO#), location_id‚Üílocation_dest_id, state (draft‚Üíassigned‚Üídone)',
            },
            {
              table: 'stock_move',
              purpose:
                'Individual inventory movements - move X units from A to B. Only state=done updates inventory',
              columns:
                'product_uom_qty (requested), quantity_done (actual), state, picking_id, production_id',
            },
            {
              table: 'stock_move_line',
              purpose:
                'Detailed lines within stock_move - for lot/serial tracking (one move can have multiple lots)',
              columns: 'move_id, qty_done, location_id‚Üílocation_dest_id',
            },
            {
              table: 'stock_valuation_layer',
              purpose:
                '‚≠ê FIFO COSTING - each receipt creates a layer; consumption decrements oldest first',
              columns:
                'quantity, unit_cost (from PO), remaining_qty (unconsumed), remaining_value (for GL)',
            },
            {
              table: 'product_supplierinfo',
              purpose:
                'Supplier-specific pricing/lead times per product - critical for PO cost calculation',
              columns:
                'supplier_id, component_id, price, min_qty (MOQ), delay (lead time days), case_qty',
            },
            {
              table: 'stock_scrap',
              purpose: 'Track scrapped/damaged inventory - moves stock to scrap location',
              columns:
                'scrap_qty, location_id (from), scrap_location_id (to), production_id (if during MO)',
            },
            {
              table: 'stock_landed_cost',
              purpose: 'Add freight/duties/customs to inventory value after receipt',
              columns:
                'amount_total, state, vendor_bill_id, split_method (equal, by_qty, by_weight)',
            },
            {
              table: 'stock_landed_cost_lines',
              purpose:
                'Individual cost items within a landed cost (freight line, customs line, etc.)',
              columns: 'cost_id, name, product_id, price_unit, split_method, account_id',
            },
            {
              table: 'stock_landed_cost_stock_picking_rel',
              purpose: 'Junction: which receipts (pickings) a landed cost applies to',
              columns: 'stock_landed_cost_id, stock_picking_id',
            },
            {
              table: 'mrp_unbuild',
              purpose:
                'Disassembly orders - reverse a BOM to recover components from finished product',
              columns:
                'product_id (to unbuild), bom_id, product_qty, production_id (optional - unbuild specific MO), state',
            },
          ],
          implementation: [
            'Incremental rollout: MO ‚Üí Adjustments ‚Üí BOMs ‚Üí Locations ‚Üí Products',
            'Pattern: build feature in SERP ‚Üí users switch to SERP UI ‚Üí disable Odoo UI',
            'Dual-write on every action: XML-RPC to Odoo + update SERP tables',
            '--- USES SYNC QUEUE FROM PHASE 1 ---',
            '‚Ä¢ Same odoo_sync_queue table and infrastructure built in Phase 1',
            '‚Ä¢ Extend with new entity_types: mrp_production, stock_move, mrp_bom, stock_location, product',
            '‚Ä¢ Same retry logic, DLQ, circuit breaker patterns',
            '--- END SYNC QUEUE ---',
            'stock_quants is independent shadow table (NOT linked to component/RM inventory)',
            'Existing component_inventory unchanged during this phase',
            'Manufacturing: MO in SERP, dual-writes to Odoo mrp_production',
            'MO scrapping/cancellation: cancel defective MOs, reverse any partial consumption',
            'Adjustments: adjustment in SERP updates stock_quants + XML-RPC to Odoo stock_move',
            'BOMs: BOM management in SERP, syncs to Odoo mrp_bom',
            'Stock locations: location hierarchy in SERP, syncs to Odoo stock_location',
            'Products: product info in SERP, syncs to Odoo product_product',
            'COGS tracking: valuation layers updated on MO completion and adjustments',
            'Odoo stays in sync but users stop using Odoo UI for migrated features',
            'Python function suite: reusable functions for inventory ops that maintain DB integrity',
            'Functions: make_adjustment(), receive_arrival(), complete_mo(), scrap_mo()',
            'All functions enforce COGS structure, update valuation layers, log transactions',
          ],
          confirmations: [
            'Production team - MO creation and completion workflow',
            'Warehouse team - inventory adjustments and location management',
            'Finance team - COGS calculations and valuation accuracy',
            'Operations team - BOM management and product info',
          ],
          keyPoint:
            'SERP becomes the UI, dual-writes to Odoo. stock_quants is independent (not linked to component inventory yet). Feature-by-feature migration.',
        },
        {
          id: 5,
          name: 'Kits',
          shortName: 'Kits',
          weeks: 13,
          deps: [1],
          parallelWith: [3, 4],
          color: '#3498db',
          milestone: 'Kit Migration Complete',
          goal: 'Start planning immediately, migrate phantom BOMs from Odoo to Laravel. ADDITIVE logic: use BOTH existing kits AND Laravel BOMs together.',
          goals: [
            'Begin discovery and planning immediately (parallel with Phase 1)',
            'Meet with Carolyn to understand kit/BOM workflows and requirements',
            'Migrate phantom BOMs from Odoo mrp_bom to Laravel mrp_bom table',
            'Modify updateInsertKit() to query BOTH existing kits AND Laravel mrp_bom (additive logic)',
            'Match buyer_products.sku ‚Üí product_template.default_code ‚Üí mrp_bom',
            'Create ComponentOrders from BOTH sources - union of kit components + BOM components',
            'Build kit editing UI in SERP (create, edit, delete kits)',
            'Deprecate Odoo phantom BOM lookups',
          ],
          tasks: [
            {
              name: 'Discovery: Map current kit/BOM workflows with Carolyn',
              startWeek: 1,
              duration: 2,
            },
            {
              name: 'Document requirements: what Odoo BOMs do vs Laravel kits',
              startWeek: 2,
              duration: 1,
            },
            {
              name: 'Design: Plan ADDITIVE logic (how kit + BOM combine)',
              startWeek: 3,
              duration: 1,
            },
            {
              name: 'Review edge cases: zero-qty consumables, inactive BOMs, overlaps',
              startWeek: 4,
              duration: 1,
            },
            {
              name: 'Create SERP tables: mrp_bom, mrp_bom_line, product_template',
              startWeek: 5,
              duration: 1,
            },
            {
              name: 'Build migration script: export Odoo phantom BOMs + lines',
              startWeek: 5,
              duration: 1,
            },
            {
              name: 'Run migration: load 265 BOMs + ~800 lines into SERP',
              startWeek: 6,
              duration: 1,
            },
            {
              name: 'Validate migration: verify component mappings, count records',
              startWeek: 7,
              duration: 1,
            },
            {
              name: 'Modify updateInsertKit() for ADDITIVE logic (kit + BOM combined)',
              startWeek: 8,
              duration: 1,
            },
            {
              name: 'Build SERP kit editing UI (list, create, edit, delete kits)',
              startWeek: 9,
              duration: 2,
            },
            {
              name: 'Test order expansion: verify kit + phantom BOM components combined',
              startWeek: 11,
              duration: 1,
            },
            {
              name: 'Parallel run: compare ComponentOrders between systems',
              startWeek: 12,
              duration: 1,
            },
            {
              name: 'Cutover: disable Odoo phantom BOM lookups + stabilize',
              startWeek: 13,
              duration: 1,
            },
          ],
          workflow: [
            { laravel: '--- DATA MIGRATION (Odoo ‚Üí SERP, one-time) ---', odoo: '---' },
            {
              laravel: 'Export mrp_bom WHERE type=phantom AND active=true (265 BOMs)',
              odoo: 'Source',
            },
            {
              laravel: 'Export mrp_bom_line for those BOMs (~800 component records)',
              odoo: 'Source',
            },
            { laravel: 'Export product_template for SKU matching (default_code)', odoo: 'Source' },
            {
              laravel: 'Load into SERP mrp_bom + mrp_bom_line + product_template tables',
              odoo: '‚Äî',
            },
            { laravel: 'Validate: verify component_id mappings, count records', odoo: '‚Äî' },
            { laravel: '--- ADDITIVE LOGIC (do BOTH kits + BOMs) ---', odoo: '---' },
            { laravel: '1. Get existing kit components (if buyer_product has kit)', odoo: '‚Äî' },
            { laravel: '2. ALSO query mrp_bom WHERE type=phantom AND active=true', odoo: '‚Äî' },
            { laravel: '3. Match: buyer_products.sku = product_template.default_code', odoo: '‚Äî' },
            { laravel: '4. Get mrp_bom_line ‚Üí map product_id to components.odoo_id', odoo: '‚Äî' },
            { laravel: '5. UNION both sets of components (kit + BOM)', odoo: '‚Äî' },
            {
              laravel: '6. Create ComponentOrders for ALL components from both sources',
              odoo: 'Deprecated',
            },
          ],
          dataOwnership: [
            { data: 'mrp_bom (phantom type)', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'mrp_bom_line (components)', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'product_template (SKU matching)', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'Existing kits table', laravel: 'Owner (unchanged)', odoo: '‚Äî' },
          ],
          dbChanges: [
            {
              table: 'mrp_bom (CREATE in SERP)',
              purpose:
                'Phantom BOMs migrated from Odoo. 265 active records. Same schema as Odoo for compatibility.',
              columns:
                'id, code, product_tmpl_id, type (phantom), active, product_qty, product_uom_id, odoo_bom_id (link back to Odoo)',
            },
            {
              table: 'mrp_bom_line (CREATE in SERP)',
              purpose: 'BOM components migrated from Odoo. ~800 records for 265 phantom BOMs.',
              columns:
                'id, bom_id (FK), product_id (‚Üí components.odoo_id), product_qty, sequence, odoo_bom_line_id',
            },
            {
              table: 'product_template (CREATE in SERP)',
              purpose:
                'SKU mapping table. Links buyer_products.sku to mrp_bom via default_code field.',
              columns: 'id, name, default_code (SKU), odoo_product_tmpl_id',
            },
            {
              table: 'kits (EXISTS - unchanged)',
              purpose: 'Existing Laravel kits table. 1,091 active kits. NOT replaced by mrp_bom.',
              columns: 'Unchanged - both kits AND mrp_bom used together (additive)',
            },
            {
              table: 'component_kits (EXISTS - unchanged)',
              purpose: 'Existing kit-component mappings. Used alongside mrp_bom_line.',
              columns: 'Unchanged - additive logic unions both sources',
            },
          ],
          implementation: {
            'Data Migration (Odoo ‚Üí SERP)': [
              '--- WHAT GETS MIGRATED ---',
              'mrp_bom: 265 active phantom BOMs (type=phantom, active=true)',
              'mrp_bom_line: ~800 component records linked to those BOMs',
              'product_template: SKU mapping table (default_code = buyer_products.sku)',
              '--- MIGRATION SCRIPT ---',
              'Export from Odoo: mrp_bom JOIN mrp_bom_line JOIN product_template',
              'Transform: map product_id ‚Üí components.odoo_id for each line',
              'Load into Laravel: mrp_bom + mrp_bom_line tables (same schema as Odoo)',
              'Validate: count records, verify component mappings exist',
              '--- EDGE CASES ---',
              'Zero-qty consumables (tape, labels): preserved with qty=0',
              'Inactive BOMs (511 records): NOT migrated - only active=true',
              'Normal BOMs (977 records): migrated in Phase 2, not this phase',
            ],
            'Code Changes (updateInsertKit)': [
              'ADDITIVE LOGIC: Query BOTH existing kits AND mrp_bom (not fallback)',
              'Step 1: Get kit components if buyer_product has assigned kit',
              'Step 2: Match buyer_products.sku = product_template.default_code',
              'Step 3: Query mrp_bom WHERE product_tmpl_id=X AND type=phantom AND active=true',
              'Step 4: Loop mrp_bom_line ‚Üí map product_id to components.odoo_id',
              'Step 5: UNION kit components + BOM components (dedupe by component_id if needed)',
              'Step 6: Create ComponentOrder for EACH component from combined set',
              'Deduct inventory from component location (same as existing)',
            ],
            'Odoo Sync (Already Handled)': [
              'ComponentOrders already sync to Odoo via existing /api/odoo/component/prepick endpoint',
              'Odoo polls Laravel, fetches orders where component_imported=0',
              'ComponentResource sends: odoo_id, sku, name, quantity from pivot table',
              'No additional sync code needed - phantom BOM ComponentOrders work automatically',
            ],
            Validation: [
              'Diff report: compare ComponentOrders created by Laravel vs Odoo',
              'Test orders with kits (existing path unchanged)',
              'Test orders without kits (new phantom BOM path)',
              'Verify component mapping: mrp_bom_line.product_id ‚Üí components.odoo_id',
              'Verify ComponentOrders from phantom BOMs sync to Odoo correctly',
            ],
          },
          confirmations: [
            'Ops - phantom BOM components match expected packaging',
            'Tech - ComponentOrders created correctly for both kit and BOM paths',
          ],
          keyPoint:
            'ADDITIVE: updateInsertKit() uses BOTH existing kits AND Laravel mrp_bom (not fallback). Components from both sources are unioned. SKU matching: buyer_products.sku = product_template.default_code.',
        },
        {
          id: 6,
          name: 'Inventory Management',
          shortName: 'Inventory',
          weeks: 9,
          deps: [4, 5],
          color: '#dc3545',
          milestone: 'Full Inventory Cutover',
          goal: 'Make SERP the source of truth for inventory. Create views to expose stock_quant quantities. Build order processing queue. Build financial reports for Ric. Deprecate Odoo.',
          goals: [
            'Migrate all inventory from Odoo to SERP stock_quant (quantities + FIFO cost layers)',
            'Make stock_quant the single source of truth for inventory',
            'Create inventory views (receiver_product_inventory, component_inventory) that aggregate stock_quant',
            'Update all code to JOIN views instead of reading inventory_qty columns',
            'Build order processing queue (reserve ‚Üí ship ‚Üí COGS)',
            'Build financial reports for Ric (Valuation, Roll Forward, FIFO COGS, Cost Tracking)',
            'Complete cutover: activate SERP queues, disable Odoo sync',
          ],
          tasks: [
            {
              name: 'Create receiver_product_inventory view + update code',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Build order processing queue (reserve, ship, cancel)',
              startWeek: 2,
              duration: 2,
            },
            {
              name: 'Build financial reports (Valuation, Roll Forward, FIFO COGS)',
              startWeek: 3,
              duration: 1,
            },
            {
              name: '‚ö° PARALLEL RUN: compare SERP vs Odoo inventory daily',
              startWeek: 4,
              duration: 4,
            },
            {
              name: 'Freeze Odoo, migrate inventory + FIFO layers to SERP',
              startWeek: 8,
              duration: 1,
            },
            {
              name: 'Physical count, reconcile, validate with Ric + go-live',
              startWeek: 9,
              duration: 1,
            },
          ],
          workflow: {
            'Inventory Views': [
              { laravel: 'stock_quant is source of truth for inventory quantities', odoo: '‚Äî' },
              {
                laravel:
                  'receiver_product_inventory view aggregates stock_quant by receiver_product_id',
                odoo: '‚Äî',
              },
              {
                laravel: 'component_inventory view aggregates stock_quant by component_id',
                odoo: '‚Äî',
              },
              { laravel: 'Code JOINs views instead of reading inventory_qty columns', odoo: '‚Äî' },
              { laravel: 'Physical count reconciliation before cutover', odoo: 'Final sync' },
            ],
            'Order Flow': [
              { laravel: 'Order created ‚Üí stock_move_id = NULL', odoo: '‚Äî' },
              { laravel: 'SERP queue finds unprocessed (WHERE stock_move_id IS NULL)', odoo: '‚Äî' },
              { laravel: 'SERP reserves inventory, writes stock_move_id back', odoo: '‚Äî' },
              { laravel: 'Order ships ‚Üí SERP consumes FIFO, writes cost_unit back', odoo: '‚Äî' },
              { laravel: 'Order cancelled before ship ‚Üí release reservation', odoo: '‚Äî' },
            ],
          },
          dataOwnership: [
            { data: 'stock_quant (source of truth)', laravel: 'Owner', odoo: 'Deprecated' },
            {
              data: 'receiver_product_inventory (view)',
              laravel: 'Aggregates stock_quant',
              odoo: '‚Äî',
            },
            { data: 'component_inventory (view)', laravel: 'Aggregates stock_quant', odoo: '‚Äî' },
            { data: 'Order inventory deductions', laravel: 'Owner', odoo: 'Deprecated' },
            { data: 'COGS (cost_unit on items/component_orders)', laravel: 'Owner', odoo: '‚Äî' },
          ],
          dbChanges: [
            {
              table: 'receiver_product_inventory (VIEW)',
              purpose:
                'Aggregates stock_quant for finished goods - replaces receiver_products.inventory_qty column',
              columns:
                'receiver_product_id, total_qty, reserved_qty, available_qty (total - reserved)',
            },
            {
              table: 'component_inventory (VIEW)',
              purpose:
                'Aggregates stock_quant for components - replaces components.inventory_qty column',
              columns: 'component_id, total_qty, reserved_qty, available_qty (total - reserved)',
            },
            {
              table: 'items',
              purpose: 'Link order items to inventory moves + track FIFO cost at fulfillment',
              columns: 'stock_move_id (FK to stock_move), cost_unit (FIFO cost per unit)',
            },
            {
              table: 'component_orders',
              purpose: 'Link component orders to inventory moves + track FIFO cost at fulfillment',
              columns: 'stock_move_id (FK to stock_move), cost_unit (FIFO cost per unit)',
            },
            {
              table: 'ec_order',
              purpose: 'Track order state and link to warehouse picking operations',
              columns:
                'serp_state (pending‚Üíconfirmed‚Üífulfilled), serp_picking_id (FK to stock_picking)',
            },
            {
              table: '‚ùå DROP legacy tables',
              purpose: 'Remove tables replaced by Odoo-style inventory system',
              columns:
                'serp_audit_logs, component_shelves, supplier_product, raw_materials, raw_material_inventory, rm_inventory_transactions, component_inventory, component_inventory_transactions',
            },
          ],
          implementation: {
            'Inventory Views': [
              'Create receiver_product_inventory view: SELECT receiver_product_id, SUM(quantity), SUM(reserved_quantity) FROM stock_quant GROUP BY receiver_product_id',
              'Create component_inventory view: SELECT component_id, SUM(quantity), SUM(reserved_quantity) FROM stock_quant GROUP BY component_id',
              'Index stock_quant on (receiver_product_id) and (component_id) for view performance',
            ],
            'Code Migration': [
              'Find all code reading receiver_products.inventory_qty ‚Üí change to JOIN receiver_product_inventory',
              'Find all code reading components.inventory_qty ‚Üí change to JOIN component_inventory',
              'Update queries, reports, dashboards, APIs that reference inventory columns',
              'Test all inventory-related features with new views',
            ],
            'Database Changes': [
              'items: ADD stock_move_id (BIGINT), cost_unit (DECIMAL 12,4)',
              'component_orders: ADD stock_move_id (BIGINT), cost_unit (DECIMAL 12,4)',
            ],
            'Order Processing Queue': [
              'Queue runs every 5 minutes',
              'Process new orders: find items/component_orders WHERE stock_move_id IS NULL',
              'Fulfill shipped orders: when ec_order.ship_date is set, consume FIFO, write cost_unit',
              'Cancel orders: if cancelled before ship, release reservation',
            ],
            'New Order Processing': [
              'Find ec_order where line items have no stock_move_id',
              'Map items.product_sku ‚Üí receiver_products',
              'Create stock_picking + stock_move, reserve inventory',
              'Write stock_move_id back to items/component_orders',
            ],
            'Ship Order Processing': [
              'Find orders where ship_date is set but cost_unit is empty',
              'Consume oldest FIFO layers, decrease stock_quant.quantity',
              'Write cost_unit to items/component_orders',
            ],
            'Cancel Order Processing': [
              'Before ship: release reservation, cancel moves',
              'After ship: no action - COGS already recorded',
            ],
            'Data Migration': [
              'Export all receiver_product inventory from Odoo stock_quant to SERP stock_quant',
              'Export all component inventory from Odoo stock_quant to SERP stock_quant',
              'Export FIFO cost layers from Odoo stock_valuation_layer to SERP',
              'Physical count reconciliation to verify migrated quantities',
            ],
          },
          cutoverChecklist: [
            'All inventory data migrated from Odoo to SERP stock_quant',
            'All code updated to use inventory views (no direct inventory_qty reads)',
            'Inventory views created and tested (receiver_product_inventory, component_inventory)',
            'SERP order processing queue built and tested',
            'Parallel run completed (both Odoo and SERP process same orders)',
            'COGS accuracy validated between Odoo and SERP',
            'Physical count reconciliation completed',
            'Legacy tables dropped (serp_audit_logs, component_shelves, etc.)',
            'Odoo order sync disabled',
            'SERP order queue activated as primary',
            'Monitoring/alerting configured for queue failures',
            'Rollback plan documented and tested',
          ],
          confirmations: [
            'Ops - inventory counts match stock_quant',
            'Finance - COGS calculations and valuation accuracy',
            'Tech - all syncs work',
          ],
          keyPoint:
            'SERP becomes source of truth. Inventory views aggregate stock_quant (no sync needed). Order queue handles reservations and COGS.',
        },
        {
          id: 7,
          name: 'Laravel Order Queue (All Orders)',
          shortName: 'Laravel All Orders',
          weeks: 2,
          deps: [4, 5],
          parallelWith: [6],
          color: '#e74c3c',
          milestone: 'All Orders Process Through SERP',
          goal: 'Laravel developer expands order queue processor from custom branding only to ALL orders. Removes filter, processes all ec_order inventory through SERP.',
          goals: [
            'Modify OrderObserver to process ALL orders (not just merchandise_selections)',
            'Expand queue to handle all ec_order ‚Üí items deductions',
            'Expand queue to handle all ec_order ‚Üí component_orders deductions',
            'Remove custom branding filter',
            'Full parallel run with all order types',
          ],
          tasks: [
            {
              name: 'Modify OrderObserver to process ALL orders',
              startWeek: 1,
              duration: 1,
            },
            {
              name: 'Integration testing with all order types + stabilization',
              startWeek: 2,
              duration: 1,
            },
          ],
          workflow: [
            {
              laravel: 'Remove filter: process ALL ec_order (not just merchandise_selections)',
              odoo: '‚Äî',
            },
            { laravel: 'On order create: queue reserve for items + component_orders', odoo: '‚Äî' },
            { laravel: 'On ship: queue ship event', odoo: '‚Äî' },
            { laravel: 'On cancel: queue cancel event', odoo: '‚Äî' },
            { laravel: 'SERP processes all inventory movements via same API', odoo: '‚Äî' },
          ],
          dataOwnership: [{ data: 'All ec_order inventory', laravel: 'Queued to SERP', odoo: '‚Äî' }],
          dbChanges: [
            {
              table: 'serp_order_queue (modify)',
              purpose: 'Expand filter: process all orders, not just custom branding',
              columns: 'No schema changes - just logic changes in OrderObserver',
            },
          ],
          implementation: [
            'Modify OrderObserver: remove merchandise_selections filter',
            'Queue ALL orders for SERP processing',
            'Test with regular orders (items), kit orders (component_orders), and custom branding',
            'Validate COGS write-back for all order types',
            'Monitor queue depth and processing time',
          ],
          confirmations: [
            'Ops team - all orders process correctly',
            'Finance team - COGS accurate for all order types',
          ],
          keyPoint:
            'Laravel developer task (parallel with Phase 6). Expands queue from custom branding only to ALL orders. 2 weeks of work.',
        },
      ];

      function addDays(d, n) {
        const r = new Date(d);
        r.setDate(r.getDate() + n);
        return r;
      }
      function addWeeks(d, w) {
        return addDays(d, w * 7);
      }
      function fmt(d) {
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }
      function fmtFull(d) {
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }

      function calcSchedules() {
        const start = new Date(project.startDate);
        const ends = new Map();
        return phases.map((p) => {
          let s = start;
          p.deps.forEach((id) => {
            const e = ends.get(id);
            if (e && e > s) s = e;
          });
          const e = addWeeks(s, p.weeks);
          ends.set(p.id, e);
          return {
            phase: p,
            start: s,
            end: e,
            isParallel: p.parallelWith && p.parallelWith.length > 0,
          };
        });
      }

      function renderPhaseDetail(sched) {
        const p = sched.phase;
        const start = sched.start;
        let html = `<div class="phase-detail">
    <div class="phase-header" style="border-left-color:${p.color}" onclick="togglePhase(${p.id})">
      <h2><span class="toggle">‚ñ∂</span> Phase ${p.id}: ${p.name}</h2>
      <div class="phase-meta-info">${fmtFull(sched.start)} ‚Üí ${fmtFull(sched.end)} (${p.weeks} weeks)${sched.isParallel ? ' ‚Ä¢ Runs in parallel' : ''}</div>
      <div class="phase-goal-text">${p.goal}</div>
    </div>
    <div class="phase-content" id="phase-content-${p.id}">`;

        // Goals
        if (p.goals && p.goals.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Goals</h3><ul>`;
          p.goals.forEach((g) => (html += `<li>${g}</li>`));
          html += `</ul></div>`;
        }

        // Workflow
        html += `<div class="section"><h3 style="border-color:${p.color}">How It Works</h3>`;
        if (Array.isArray(p.workflow)) {
          html += `<table class="workflow-table"><tr><th>SERP (Laravel)</th><th style="width:40px"></th><th>Odoo</th></tr>`;
          p.workflow.forEach((row) => {
            if (row.laravel.startsWith('---')) {
              const headerText = row.laravel.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
              html += `<tr><td colspan="3" style="background:${p.color}15;color:${p.color};font-weight:600;text-align:center;padding:12px;border-top:2px solid ${p.color}">${headerText}</td></tr>`;
            } else {
              const rowClass = row.sync ? 'sync-row' : '';
              const arrow = row.sync ? '‚Üí' : '';
              html += `<tr class="${rowClass}"><td>${row.laravel}</td><td class="arrow">${arrow}</td><td>${row.odoo}</td></tr>`;
            }
          });
          html += `</table>`;
        } else {
          Object.entries(p.workflow).forEach(([header, rows]) => {
            html += `<h4>${header}</h4><table class="workflow-table"><tr><th>SERP (Laravel)</th><th style="width:40px"></th><th>Odoo</th></tr>`;
            rows.forEach((row) => {
              if (row.laravel.startsWith('---')) {
                const headerText = row.laravel.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
                html += `<tr><td colspan="3" style="background:${p.color}15;color:${p.color};font-weight:600;text-align:center;padding:12px">${headerText}</td></tr>`;
              } else {
                const rowClass = row.sync ? 'sync-row' : '';
                const arrow = row.sync ? '‚Üí' : '';
                html += `<tr class="${rowClass}"><td>${row.laravel}</td><td class="arrow">${arrow}</td><td>${row.odoo}</td></tr>`;
              }
            });
            html += `</table>`;
          });
        }
        if (p.keyPoint)
          html += `<div class="highlight" style="border-color:${p.color}"><strong>${p.keyPoint}</strong></div>`;
        html += `</div>`;

        // Data Ownership
        html += `<div class="section"><h3 style="border-color:${p.color}">Data Ownership</h3>`;
        html += `<table><tr><th>Data</th><th>SERP</th><th>Odoo</th></tr>`;
        p.dataOwnership.forEach((row) => {
          const laravelClass = row.laravel.includes('Owner') ? 'owner-cell' : 'copy-cell';
          const odooClass = row.odoo.includes('Owner') ? 'owner-cell' : 'copy-cell';
          html += `<tr><td>${row.data}</td><td class="${laravelClass}">${row.laravel}</td><td class="${odooClass}">${row.odoo}</td></tr>`;
        });
        html += `</table></div>`;

        // Database Changes
        html += `<div class="section"><h3 style="border-color:${p.color}">Database Changes</h3>`;
        html += `<table><tr><th>Table</th><th>Purpose</th><th>Columns</th></tr>`;
        p.dbChanges.forEach((row) => {
          html += `<tr><td><code>${row.table}</code></td><td>${row.purpose || ''}</td><td><code>${row.columns}</code></td></tr>`;
        });
        html += `</table></div>`;

        // Implementation
        html += `<div class="section"><h3 style="border-color:${p.color}">Implementation Details</h3>`;
        if (Array.isArray(p.implementation)) {
          html += `<ul>`;
          p.implementation.forEach((item) => {
            if (item.startsWith('---') && item.endsWith('---')) {
              const headerText = item.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
              html += `</ul><h4 style="margin-top:20px;color:${p.color}">${headerText}</h4><ul>`;
            } else {
              html += `<li>${item}</li>`;
            }
          });
          html += `</ul>`;
        } else {
          Object.entries(p.implementation).forEach(([header, items]) => {
            html += `<h4>${header}</h4><ul>`;
            items.forEach((item) => {
              if (item.startsWith('---')) {
                const headerText = item.replace(/^-+\s*/, '').replace(/\s*-+$/, '');
                html += `</ul><h4 style="color:${p.color}">${headerText}</h4><ul>`;
              } else {
                html += `<li>${item}</li>`;
              }
            });
            html += `</ul>`;
          });
        }
        html += `</div>`;

        // Cutover Checklist
        if (p.cutoverChecklist && p.cutoverChecklist.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Cutover Checklist</h3><ul>`;
          p.cutoverChecklist.forEach((item) => (html += `<li>‚òê ${item}</li>`));
          html += `</ul></div>`;
        }

        // Confirmations
        if (p.confirmations && p.confirmations.length) {
          html += `<div class="section"><h3 style="border-color:${p.color}">Team Confirmations Before Launch</h3><ul>`;
          p.confirmations.forEach((item) => (html += `<li>${item}</li>`));
          html += `</ul></div>`;
        }

        // Timeline
        html += `<div class="section"><h3 style="border-color:${p.color}">Timeline</h3>`;
        html += `<div class="gantt-container"><div class="gantt-header"><div class="gantt-label">Task</div><div class="gantt-weeks">`;
        for (let w = 1; w <= p.weeks; w++) {
          const weekStart = addDays(start, (w - 1) * 7);
          html += `<div class="week-col">W${w}<br><span class="week-dates">${fmt(weekStart)}</span></div>`;
        }
        html += `</div></div>`;
        p.tasks.forEach((task) => {
          const left = ((task.startWeek - 1) / p.weeks) * 100;
          const width = (task.duration / p.weeks) * 100;
          html += `<div class="gantt-row"><div class="task-label">${task.name}</div>`;
          html += `<div class="task-track">${Array(p.weeks).fill('<div class="task-cell"></div>').join('')}`;
          html += `<div class="task-bar" style="left:${left}%;width:${width}%;background:${p.color}">${task.duration}w</div></div></div>`;
        });
        html += `</div></div>`;

        html += `</div></div>`;
        return html;
      }

      function togglePhase(id) {
        const content = document.getElementById(`phase-content-${id}`);
        const header = content.previousElementSibling;
        content.classList.toggle('hide');
        header.classList.toggle('collapsed');
      }

      // Migration events - when data actually gets imported from Odoo
      const migrationEvents = [
        {
          phase: 1,
          week: 1,
          name: 'Custom Branding Setup',
          desc: 'Create custom branding products and initial inventory in SERP. No Odoo import - built from scratch.',
          tables: [
            'components (custom branding)',
            'stock_quant (custom inventory)',
            'stock_location (warehouse bins)',
          ],
          color: '#e67e22',
        },
        {
          phase: 3,
          week: 4,
          name: 'Import PO/Supplier Data',
          desc: 'After schema design finalized, import PO and supplier data into SERP tables. Development continues against real data.',
          tables: [
            'purchase_order (1.8K)',
            'purchase_order_line (16K)',
            'res_partner (289 suppliers)',
            'product_supplierinfo (2.6K)',
            'account_move (vendor bills only)',
          ],
          color: '#198754',
        },
        {
          phase: 3,
          week: 8,
          name: 'Run Migration Scripts',
          desc: 'Execute data cleanup, transformation, and validation scripts. Link SERP components to Odoo products.',
          tables: [
            'Data cleanup',
            'qty_received/qty_invoiced',
            'supplier-product links',
            'bill line matching',
          ],
          color: '#198754',
        },
        {
          phase: 4,
          week: 3,
          name: 'Import MO/BOM/Product Data',
          desc: 'Import manufacturing orders, BOMs, products, and locations after core schemas built.',
          tables: [
            'mrp_production (26K)',
            'mrp_bom (2K)',
            'mrp_bom_line (6.5K)',
            'product_product (7K)',
            'product_template (7K)',
            'mrp_unbuild (184)',
            'stock_location (2.7K)',
          ],
          color: '#9b59b6',
        },
        {
          phase: 5,
          week: 2,
          name: 'Import Kit BOMs',
          desc: 'Import phantom BOMs for kit explosion. Filter mrp_bom where type=phantom.',
          tables: ['mrp_bom (phantom)', 'mrp_bom_line (kit components)'],
          color: '#3498db',
        },
        {
          phase: 6,
          week: 4,
          name: 'Test Inventory Import (Optional)',
          desc: 'Practice run: export Odoo inventory snapshot to validate import scripts. Data will be stale - for testing only.',
          tables: [
            'stock_quant (14K) - TEST',
            'stock_valuation_layer (sample)',
            'Validate import scripts',
          ],
          color: '#ffc107',
        },
        {
          phase: 6,
          week: 8,
          name: 'üö® INVENTORY CUTOVER',
          desc: 'THE migration moment. Freeze Odoo, physical count, import current inventory. This is the only time inventory data is imported for real.',
          tables: [
            'stock_quant (14K) - LIVE',
            'stock_valuation_layer (current FIFO layers)',
            'stock_scrap (1.4K)',
            'stock_landed_cost (87)',
            'stock_landed_cost_lines (88)',
          ],
          color: '#dc3545',
        },
        {
          phase: 6,
          week: 9,
          name: 'Odoo Deprecated',
          desc: 'Validate inventory accuracy, reconcile counts with system, train warehouse team. Odoo becomes read-only archive.',
          tables: [
            'Physical count validation',
            'Book vs actual reconciliation',
            'Odoo ‚Üí read-only',
          ],
          color: '#dc3545',
        },
      ];

      function render() {
        const scheds = calcSchedules();
        const start = new Date(project.startDate);
        const end = scheds.reduce((max, s) => (s.end > max ? s.end : max), scheds[0].end);

        document.getElementById('meta').textContent =
          `${fmtFull(start)} ‚Üí ${fmtFull(end)} | ${project.preparedBy}`;

        const totalWeeks = Math.ceil((end - start) / (7 * 24 * 60 * 60 * 1000));
        const totalTasks = phases.reduce((s, p) => s + p.tasks.length, 0);
        document.getElementById('summary').innerHTML = `
    <div class="summary-card"><div class="value">${phases.length}</div><div class="label">Phases</div></div>
    <div class="summary-card"><div class="value">${totalWeeks}</div><div class="label">Weeks</div></div>
    <div class="summary-card"><div class="value">${totalTasks}</div><div class="label">Tasks</div></div>
    <div class="summary-card"><div class="value">${fmt(end)}</div><div class="label">Target</div></div>
  `;

        const months = [];
        let cur = new Date(start);
        while (cur <= end) {
          months.push(cur.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }));
          cur = new Date(cur.getFullYear(), cur.getMonth() + 1, 1);
        }
        document.getElementById('months').innerHTML = months
          .map((m) => `<div class="month-col">${m}</div>`)
          .join('');

        const totalDays = (end - start) / (24 * 60 * 60 * 1000);
        document.getElementById('timeline').innerHTML = scheds
          .map((s) => {
            const left = ((s.start - start) / (24 * 60 * 60 * 1000) / totalDays) * 100;
            const width = ((s.end - s.start) / (24 * 60 * 60 * 1000) / totalDays) * 100;
            const parallelLabel = s.isParallel ? ' ‚à•' : '';
            return `<div class="phase-row">
      <div class="phase-label">Phase ${s.phase.id}: ${s.phase.shortName}${parallelLabel}</div>
      <div class="phase-track">
        <div class="phase-bar" style="left:${left}%;width:${width}%;background:${s.phase.color}">
          <span>${s.phase.name}</span>
          <span class="phase-dates">${fmt(s.start)} ‚Üí ${fmt(s.end)}</span>
        </div>
      </div>
    </div>`;
          })
          .join('');

        // Render migration events with calculated dates
        document.getElementById('migration-events').innerHTML = migrationEvents
          .map((evt) => {
            const phaseSched = scheds.find((s) => s.phase.id === evt.phase);
            const eventDate = addDays(phaseSched.start, (evt.week - 1) * 7);
            return `<div class="migration-event">
      <div class="migration-event-phase" style="color:${evt.color}">Phase ${evt.phase}</div>
      <div class="migration-event-week">Week ${evt.week}<br><span style="font-size:0.8em">${fmt(eventDate)}</span></div>
      <div class="migration-event-info">
        <div class="migration-event-name">${evt.name}</div>
        <div class="migration-event-desc">${evt.desc}</div>
        <div class="migration-event-tables">${evt.tables.map((t) => `<code>${t}</code>`).join('')}</div>
      </div>
    </div>`;
          })
          .join('');

        document.getElementById('milestones').innerHTML = scheds
          .map(
            (s) => `
    <div class="milestone-item">
      <div class="milestone-dot" style="background:${s.phase.color}"></div>
      <div class="milestone-info">
        <div class="milestone-name">${s.phase.milestone}</div>
        <div class="milestone-phase">Phase ${s.phase.id}</div>
      </div>
      <div class="milestone-date">${fmtFull(s.end)}</div>
    </div>
  `
          )
          .join('');

        document.getElementById('phases-detail').innerHTML = scheds
          .map((s) => renderPhaseDetail(s))
          .join('');
      }

      render();
    </script>
  </body>
</html>
